# yaml-language-server: $schema=https://schema.zeabur.app/template.json
apiVersion: zeabur.com/v1
kind: Template
metadata:
  name: PostgreSQL HA
spec:
  description: |
    High Availability PostgreSQL cluster with Patroni and etcd. Provides automatic failover and replication for production-grade database deployments.
  icon: https://raw.githubusercontent.com/zeabur/service-icons/main/marketplace/postgresql.svg
  coverImage: https://raw.githubusercontent.com/canyugs/zeabur-template/refs/heads/main/postgresql-ha/cover.png
  tags:
    - Database
    - PostgreSQL
    - High Availability
    - Patroni
  variables:
    - key: POSTGRES_SUPERUSER_PASSWORD
      type: PASSWORD
      name: Superuser Password
      description: Password for PostgreSQL superuser (postgres user)
    - key: POSTGRES_REPLICATION_PASSWORD
      type: PASSWORD
      name: Replication Password
      description: Password for PostgreSQL replication user
    - key: POSTGRES_ADMIN_PASSWORD
      type: PASSWORD
      name: Admin Password
      description: Password for PostgreSQL admin user
  readme: |
    # PostgreSQL High Availability Cluster

    This template deploys a highly available PostgreSQL cluster using:
    - **Patroni**: PostgreSQL HA solution with automatic failover
    - **Spilo**: Docker image combining PostgreSQL and Patroni
    - **etcd**: Distributed configuration and service discovery

    ## Architecture

    - 3x etcd cluster nodes for distributed consensus
    - 3x PostgreSQL nodes with Patroni for automatic failover
    - Built-in replication and health monitoring

    ## Connection Information

    Use any of the Patroni nodes to connect to the cluster:
    - **Host**: Use the hostname of patroni1, patroni2, or patroni3
    - **Port**: 5432
    - **Username**: postgres (superuser) or admin
    - **Password**: Check the environment variables in Zeabur dashboard

    Patroni will automatically route connections to the master node.

    ### User Accounts

    | Account | Username | Privileges | Use Case |
    |---------|----------|------------|----------|
    | **Superuser** | `postgres` | Full system privileges | System administration, backup/restore |
    | **Admin** | `admin` | `CREATEDB`, `CREATEROLE` | Application connections, daily development |

    > **Security**: Use `admin` or create dedicated users for applications. Avoid using `superuser` directly.

    ## Features

    - **Automatic Failover**: If the master fails, Patroni automatically promotes a replica
    - **Synchronous Replication**: Data consistency across nodes
    - **Health Monitoring**: REST API on port 8008 for each node
    - **Rolling Updates**: Update nodes without downtime
    - **Horizontal Scaling**: Easily add or remove nodes

    ## Cluster Sizing

    This 3-node configuration provides standard production HA (tolerates 1 node failure).

    | Nodes | Fault Tolerance | Use Case |
    |-------|----------------|----------|
    | 3     | 1 failure      | ‚úÖ Production (standard) |
    | 5     | 2 failures     | ‚úÖ Production (high availability) |

    ## Scaling the Cluster

    ### Adding Nodes (Scale to 5 Nodes)

    To scale from 3 to 5 nodes for higher availability:

    1. **Add etcd nodes**:
       - Deploy [**etcd4**](https://zeabur.com/templates/X877ER)
       - Deploy [**etcd5**](https://zeabur.com/templates/DYGT7Y)

    2. **Add Patroni nodes**:
       - Deploy [**Patroni4**](https://zeabur.com/templates/3ZC549)
       - Deploy [**Patroni5**](https://zeabur.com/templates/LNFEJI)

    3. **Update existing Patroni** `ETCD3_HOSTS` to include new etcd nodes:
       ```
       etcd1:2379,etcd2:2379,etcd3:2379,etcd4:2379,etcd5:2379
       ```

    ### Removing Nodes

    To scale down the cluster:

    1. Remove Patroni replica nodes (never remove the master)
    2. Remove etcd nodes after updating cluster configuration
    3. Always maintain odd number of nodes (3, 5, etc.)

    ‚ö†Ô∏è **Important**: Never reduce below 3 nodes in production to maintain HA.

    üìñ **Full Guide**: See the [complete README](https://github.com/canyugs/zeabur-template/blob/main/postgresql-ha/README.md) for step-by-step removal instructions.

    ## Management

    Run inside any Patroni container:
    ```bash
    # Cluster status
    patronictl list pg-ha

    # Show cluster configuration
    patronictl show-config pg-ha
    ```

    ## Troubleshooting

    Common operations:

    ```bash
    # Check etcd cluster health
    curl http://etcd1:2379/health

    # List etcd members
    curl -X POST http://etcd1:2379/v3/cluster/member/list

    # Check Patroni cluster status (run inside patroni container)
    patronictl list pg-ha

    # Check PostgreSQL replication
    psql -U postgres -c "SELECT * FROM pg_stat_replication;"
    ```

    üìñ **Full Troubleshooting Guide**: See the [complete README](https://github.com/canyugs/zeabur-template/blob/main/postgresql-ha/README.md#troubleshooting).

    ## Related Templates

    **etcd Expansion:**
    - [**etcd4**](https://zeabur.com/templates/X877ER): Add 4th etcd node
    - [**etcd5**](https://zeabur.com/templates/DYGT7Y): Add 5th etcd node

    **Patroni Expansion:**
    - [**Patroni4**](https://zeabur.com/templates/3ZC549): Add 4th PostgreSQL node
    - [**Patroni5**](https://zeabur.com/templates/LNFEJI): Add 5th PostgreSQL node

    ## Documentation

    - [Complete Setup and Scaling Guide](https://github.com/canyugs/zeabur-template/blob/main/postgresql-ha/README.md)
    - [Patroni Documentation](https://patroni.readthedocs.io/)
    - [Spilo GitHub](https://github.com/zalando/spilo)
    - [etcd Documentation](https://etcd.io/docs/)

  services:
    - name: etcd1
      icon: https://raw.githubusercontent.com/cncf/artwork/master/projects/etcd/icon/color/etcd-icon-color.svg
      template: PREBUILT
      spec:
        source:
          image: gcr.io/etcd-development/etcd:v3.6.6
        ports:
          - id: client
            port: 2379
            type: TCP
          - id: peer
            port: 2380
            type: TCP
          - id: metrics
            port: 2381
            type: HTTP
        volumes:
          - id: data
            dir: /etcd-data
        env:
          ETCD_NAME:
            default: etcd1
          ETCD_DATA_DIR:
            default: /etcd-data
          ETCD_INITIAL_ADVERTISE_PEER_URLS:
            default: http://etcd1:2380
          ETCD_LISTEN_PEER_URLS:
            default: http://0.0.0.0:2380
          ETCD_LISTEN_CLIENT_URLS:
            default: http://0.0.0.0:2379
          ETCD_ADVERTISE_CLIENT_URLS:
            default: http://etcd1:2379
          ETCD_LISTEN_METRICS_URLS:
            default: http://0.0.0.0:2381
          ETCD_INITIAL_CLUSTER:
            default: etcd1=http://etcd1:2380,etcd2=http://etcd2:2380,etcd3=http://etcd3:2380
          ETCD_INITIAL_CLUSTER_STATE:
            default: new
          ETCD_INITIAL_CLUSTER_TOKEN:
            default: etcd-cluster-pg-ha
        instructions:
          - title: Client Endpoint
            content: "http://${PORT_FORWARDED_HOSTNAME}:${CLIENT_PORT_FORWARDED_PORT}"
          - title: List Members
            content: "curl -X POST http://${PORT_FORWARDED_HOSTNAME}:${CLIENT_PORT_FORWARDED_PORT}/v3/cluster/member/list"
          - title: Add Member (replace service name)
            content: "curl -X POST http://${PORT_FORWARDED_HOSTNAME}:${CLIENT_PORT_FORWARDED_PORT}/v3/cluster/member/add -d '{\"peerURLs\":[\"http://etcd4:2380\"]}'"
          - title: Delete Member (replace member-id)
            content: "curl -X POST http://${PORT_FORWARDED_HOSTNAME}:${CLIENT_PORT_FORWARDED_PORT}/v3/cluster/member/remove -d '{\"ID\":\"<member-id>\"}'"
          - title: Cluster Health
            content: "curl http://${PORT_FORWARDED_HOSTNAME}:${CLIENT_PORT_FORWARDED_PORT}/health"
          - title: Put Key (test=hello)
            content: "curl -X POST http://${PORT_FORWARDED_HOSTNAME}:${CLIENT_PORT_FORWARDED_PORT}/v3/kv/put -d '{\"key\":\"dGVzdA==\",\"value\":\"aGVsbG8=\"}'"
          - title: Get Key (test)
            content: "curl -X POST http://${PORT_FORWARDED_HOSTNAME}:${CLIENT_PORT_FORWARDED_PORT}/v3/kv/range -d '{\"key\":\"dGVzdA==\"}'"

    - name: etcd2
      icon: https://raw.githubusercontent.com/cncf/artwork/master/projects/etcd/icon/color/etcd-icon-color.svg
      template: PREBUILT
      spec:
        source:
          image: gcr.io/etcd-development/etcd:v3.6.6
        ports:
          - id: client
            port: 2379
            type: TCP
          - id: peer
            port: 2380
            type: TCP
          - id: metrics
            port: 2381
            type: HTTP
        volumes:
          - id: data
            dir: /etcd-data
        env:
          ETCD_NAME:
            default: etcd2
          ETCD_DATA_DIR:
            default: /etcd-data
          ETCD_INITIAL_ADVERTISE_PEER_URLS:
            default: http://etcd2:2380
          ETCD_LISTEN_PEER_URLS:
            default: http://0.0.0.0:2380
          ETCD_LISTEN_CLIENT_URLS:
            default: http://0.0.0.0:2379
          ETCD_ADVERTISE_CLIENT_URLS:
            default: http://etcd2:2379
          ETCD_LISTEN_METRICS_URLS:
            default: http://0.0.0.0:2381
          ETCD_INITIAL_CLUSTER:
            default: etcd1=http://etcd1:2380,etcd2=http://etcd2:2380,etcd3=http://etcd3:2380
          ETCD_INITIAL_CLUSTER_STATE:
            default: new
          ETCD_INITIAL_CLUSTER_TOKEN:
            default: etcd-cluster-pg-ha
        instructions:
          - title: Client Endpoint
            content: "http://${PORT_FORWARDED_HOSTNAME}:${CLIENT_PORT_FORWARDED_PORT}"
          - title: List Members
            content: "curl -X POST http://${PORT_FORWARDED_HOSTNAME}:${CLIENT_PORT_FORWARDED_PORT}/v3/cluster/member/list"
          - title: Add Member (replace service name)
            content: "curl -X POST http://${PORT_FORWARDED_HOSTNAME}:${CLIENT_PORT_FORWARDED_PORT}/v3/cluster/member/add -d '{\"peerURLs\":[\"http://etcd4:2380\"]}'"
          - title: Delete Member (replace member-id)
            content: "curl -X POST http://${PORT_FORWARDED_HOSTNAME}:${CLIENT_PORT_FORWARDED_PORT}/v3/cluster/member/remove -d '{\"ID\":\"<member-id>\"}'"
          - title: Cluster Health
            content: "curl http://${PORT_FORWARDED_HOSTNAME}:${CLIENT_PORT_FORWARDED_PORT}/health"
          - title: Put Key (test=hello)
            content: "curl -X POST http://${PORT_FORWARDED_HOSTNAME}:${CLIENT_PORT_FORWARDED_PORT}/v3/kv/put -d '{\"key\":\"dGVzdA==\",\"value\":\"aGVsbG8=\"}'"
          - title: Get Key (test)
            content: "curl -X POST http://${PORT_FORWARDED_HOSTNAME}:${CLIENT_PORT_FORWARDED_PORT}/v3/kv/range -d '{\"key\":\"dGVzdA==\"}'"

    - name: etcd3
      icon: https://raw.githubusercontent.com/cncf/artwork/master/projects/etcd/icon/color/etcd-icon-color.svg
      template: PREBUILT
      spec:
        source:
          image: gcr.io/etcd-development/etcd:v3.6.6
        ports:
          - id: client
            port: 2379
            type: TCP
          - id: peer
            port: 2380
            type: TCP
          - id: metrics
            port: 2381
            type: HTTP
        volumes:
          - id: data
            dir: /etcd-data
        env:
          ETCD_NAME:
            default: etcd3
          ETCD_DATA_DIR:
            default: /etcd-data
          ETCD_INITIAL_ADVERTISE_PEER_URLS:
            default: http://etcd3:2380
          ETCD_LISTEN_PEER_URLS:
            default: http://0.0.0.0:2380
          ETCD_LISTEN_CLIENT_URLS:
            default: http://0.0.0.0:2379
          ETCD_ADVERTISE_CLIENT_URLS:
            default: http://etcd3:2379
          ETCD_LISTEN_METRICS_URLS:
            default: http://0.0.0.0:2381
          ETCD_INITIAL_CLUSTER:
            default: etcd1=http://etcd1:2380,etcd2=http://etcd2:2380,etcd3=http://etcd3:2380
          ETCD_INITIAL_CLUSTER_STATE:
            default: new
          ETCD_INITIAL_CLUSTER_TOKEN:
            default: etcd-cluster-pg-ha
        instructions:
          - title: Client Endpoint
            content: "http://${PORT_FORWARDED_HOSTNAME}:${CLIENT_PORT_FORWARDED_PORT}"
          - title: List Members
            content: "curl -X POST http://${PORT_FORWARDED_HOSTNAME}:${CLIENT_PORT_FORWARDED_PORT}/v3/cluster/member/list"
          - title: Add Member (replace service name)
            content: "curl -X POST http://${PORT_FORWARDED_HOSTNAME}:${CLIENT_PORT_FORWARDED_PORT}/v3/cluster/member/add -d '{\"peerURLs\":[\"http://etcd4:2380\"]}'"
          - title: Delete Member (replace member-id)
            content: "curl -X POST http://${PORT_FORWARDED_HOSTNAME}:${CLIENT_PORT_FORWARDED_PORT}/v3/cluster/member/remove -d '{\"ID\":\"<member-id>\"}'"
          - title: Cluster Health
            content: "curl http://${PORT_FORWARDED_HOSTNAME}:${CLIENT_PORT_FORWARDED_PORT}/health"
          - title: Put Key (test=hello)
            content: "curl -X POST http://${PORT_FORWARDED_HOSTNAME}:${CLIENT_PORT_FORWARDED_PORT}/v3/kv/put -d '{\"key\":\"dGVzdA==\",\"value\":\"aGVsbG8=\"}'"
          - title: Get Key (test)
            content: "curl -X POST http://${PORT_FORWARDED_HOSTNAME}:${CLIENT_PORT_FORWARDED_PORT}/v3/kv/range -d '{\"key\":\"dGVzdA==\"}'"

    - name: patroni1
      icon: https://raw.githubusercontent.com/zeabur/service-icons/main/marketplace/postgresql.svg
      template: PREBUILT
      dependencies:
        - etcd1
        - etcd2
        - etcd3
      spec:
        source:
          image: ghcr.io/zalando/spilo-15:3.2-p1
          command:
            - sh
            - -c
            - |
              # Wrapper to fix ownership after basebackup
              (
                while sleep 10; do
                  if [ -d /home/postgres/pgdata/pgroot ]; then
                    chown -R postgres:postgres /home/postgres/pgdata/pgroot 2>/dev/null || true
                  fi
                done
              ) &
              exec /launch.sh init
        ports:
          - id: database
            port: 5432
            type: TCP
          - id: api
            port: 8008
            type: HTTP
        healthCheck:
          type: HTTP
          port: api
          http:
            path: /health
        volumes:
          - id: data
            dir: /home/postgres/pgdata
        env:
          SCOPE:
            default: pg-ha
          PATRONI_NAME:
            default: patroni1
          PATRONI_RESTAPI_LISTEN:
            default: 0.0.0.0:8008
          PATRONI_RESTAPI_CONNECT_ADDRESS:
            default: ${CONTAINER_HOSTNAME}:8008
          PATRONI_POSTGRESQL_LISTEN:
            default: 0.0.0.0:5432
          PATRONI_POSTGRESQL_CONNECT_ADDRESS:
            default: ${CONTAINER_HOSTNAME}:5432
          PATRONI_SUPERUSER_USERNAME:
            default: postgres
          PATRONI_SUPERUSER_PASSWORD:
            default: ${POSTGRES_SUPERUSER_PASSWORD}
          PATRONI_REPLICATION_USERNAME:
            default: replicator
          PATRONI_REPLICATION_PASSWORD:
            default: ${POSTGRES_REPLICATION_PASSWORD}
          PATRONI_admin_USERNAME:
            default: admin
          PATRONI_admin_PASSWORD:
            default: ${POSTGRES_ADMIN_PASSWORD}
          PGPASSWORD_SUPERUSER:
            default: ${POSTGRES_SUPERUSER_PASSWORD}
          PGPASSWORD_STANDBY:
            default: ${POSTGRES_REPLICATION_PASSWORD}
          PGPASSWORD_ADMIN:
            default: ${POSTGRES_ADMIN_PASSWORD}
          ETCD3_HOSTS:
            default: etcd1:2379,etcd2:2379,etcd3:2379
        instructions:
          - title: Superuser Connection String
            content: "postgresql://postgres:${POSTGRES_SUPERUSER_PASSWORD}@${PORT_FORWARDED_HOSTNAME}:${DATABASE_PORT_FORWARDED_PORT}/postgres"
          - title: Admin Connection String
            content: "postgresql://admin:${POSTGRES_ADMIN_PASSWORD}@${PORT_FORWARDED_HOSTNAME}:${DATABASE_PORT_FORWARDED_PORT}/postgres"
          - title: Superuser Username
            content: "postgres"
          - title: Superuser Password
            content: "${POSTGRES_SUPERUSER_PASSWORD}"
          - title: Admin Username
            content: "admin"
          - title: Admin Password
            content: "${POSTGRES_ADMIN_PASSWORD}"
          - title: Cluster Status (run in container)
            content: "patronictl list pg-ha"

    - name: patroni2
      icon: https://raw.githubusercontent.com/zeabur/service-icons/main/marketplace/postgresql.svg
      template: PREBUILT
      dependencies:
        - etcd1
        - etcd2
        - etcd3
      spec:
        source:
          image: ghcr.io/zalando/spilo-15:3.2-p1
          command:
            - sh
            - -c
            - |
              # Wrapper to fix ownership after basebackup
              (
                while sleep 10; do
                  if [ -d /home/postgres/pgdata/pgroot ]; then
                    chown -R postgres:postgres /home/postgres/pgdata/pgroot 2>/dev/null || true
                  fi
                done
              ) &
              exec /launch.sh init
        ports:
          - id: database
            port: 5432
            type: TCP
          - id: api
            port: 8008
            type: HTTP
        healthCheck:
          type: HTTP
          port: api
          http:
            path: /health
        volumes:
          - id: data
            dir: /home/postgres/pgdata
        env:
          SCOPE:
            default: pg-ha
          PATRONI_NAME:
            default: patroni2
          PATRONI_RESTAPI_LISTEN:
            default: 0.0.0.0:8008
          PATRONI_RESTAPI_CONNECT_ADDRESS:
            default: ${CONTAINER_HOSTNAME}:8008
          PATRONI_POSTGRESQL_LISTEN:
            default: 0.0.0.0:5432
          PATRONI_POSTGRESQL_CONNECT_ADDRESS:
            default: ${CONTAINER_HOSTNAME}:5432
          PATRONI_SUPERUSER_USERNAME:
            default: postgres
          PATRONI_SUPERUSER_PASSWORD:
            default: ${POSTGRES_SUPERUSER_PASSWORD}
          PATRONI_REPLICATION_USERNAME:
            default: replicator
          PATRONI_REPLICATION_PASSWORD:
            default: ${POSTGRES_REPLICATION_PASSWORD}
          PATRONI_admin_USERNAME:
            default: admin
          PATRONI_admin_PASSWORD:
            default: ${POSTGRES_ADMIN_PASSWORD}
          PGPASSWORD_SUPERUSER:
            default: ${POSTGRES_SUPERUSER_PASSWORD}
          PGPASSWORD_STANDBY:
            default: ${POSTGRES_REPLICATION_PASSWORD}
          PGPASSWORD_ADMIN:
            default: ${POSTGRES_ADMIN_PASSWORD}
          ETCD3_HOSTS:
            default: etcd1:2379,etcd2:2379,etcd3:2379
        instructions:
          - title: Superuser Connection String
            content: "postgresql://postgres:${POSTGRES_SUPERUSER_PASSWORD}@${PORT_FORWARDED_HOSTNAME}:${DATABASE_PORT_FORWARDED_PORT}/postgres"
          - title: Admin Connection String
            content: "postgresql://admin:${POSTGRES_ADMIN_PASSWORD}@${PORT_FORWARDED_HOSTNAME}:${DATABASE_PORT_FORWARDED_PORT}/postgres"
          - title: Superuser Username
            content: "postgres"
          - title: Superuser Password
            content: "${POSTGRES_SUPERUSER_PASSWORD}"
          - title: Admin Username
            content: "admin"
          - title: Admin Password
            content: "${POSTGRES_ADMIN_PASSWORD}"
          - title: Cluster Status (run in container)
            content: "patronictl list pg-ha"

    - name: patroni3
      icon: https://raw.githubusercontent.com/zeabur/service-icons/main/marketplace/postgresql.svg
      template: PREBUILT
      dependencies:
        - etcd1
        - etcd2
        - etcd3
      spec:
        source:
          image: ghcr.io/zalando/spilo-15:3.2-p1
          command:
            - sh
            - -c
            - |
              # Wrapper to fix ownership after basebackup
              (
                while sleep 10; do
                  if [ -d /home/postgres/pgdata/pgroot ]; then
                    chown -R postgres:postgres /home/postgres/pgdata/pgroot 2>/dev/null || true
                  fi
                done
              ) &
              exec /launch.sh init
        ports:
          - id: database
            port: 5432
            type: TCP
          - id: api
            port: 8008
            type: HTTP
        healthCheck:
          type: HTTP
          port: api
          http:
            path: /health
        volumes:
          - id: data
            dir: /home/postgres/pgdata
        env:
          SCOPE:
            default: pg-ha
          PATRONI_NAME:
            default: patroni3
          PATRONI_RESTAPI_LISTEN:
            default: 0.0.0.0:8008
          PATRONI_RESTAPI_CONNECT_ADDRESS:
            default: ${CONTAINER_HOSTNAME}:8008
          PATRONI_POSTGRESQL_LISTEN:
            default: 0.0.0.0:5432
          PATRONI_POSTGRESQL_CONNECT_ADDRESS:
            default: ${CONTAINER_HOSTNAME}:5432
          PATRONI_SUPERUSER_USERNAME:
            default: postgres
          PATRONI_SUPERUSER_PASSWORD:
            default: ${POSTGRES_SUPERUSER_PASSWORD}
          PATRONI_REPLICATION_USERNAME:
            default: replicator
          PATRONI_REPLICATION_PASSWORD:
            default: ${POSTGRES_REPLICATION_PASSWORD}
          PATRONI_admin_USERNAME:
            default: admin
          PATRONI_admin_PASSWORD:
            default: ${POSTGRES_ADMIN_PASSWORD}
          PGPASSWORD_SUPERUSER:
            default: ${POSTGRES_SUPERUSER_PASSWORD}
          PGPASSWORD_STANDBY:
            default: ${POSTGRES_REPLICATION_PASSWORD}
          PGPASSWORD_ADMIN:
            default: ${POSTGRES_ADMIN_PASSWORD}
          ETCD3_HOSTS:
            default: etcd1:2379,etcd2:2379,etcd3:2379
        instructions:
          - title: Superuser Connection String
            content: "postgresql://postgres:${POSTGRES_SUPERUSER_PASSWORD}@${PORT_FORWARDED_HOSTNAME}:${DATABASE_PORT_FORWARDED_PORT}/postgres"
          - title: Admin Connection String
            content: "postgresql://admin:${POSTGRES_ADMIN_PASSWORD}@${PORT_FORWARDED_HOSTNAME}:${DATABASE_PORT_FORWARDED_PORT}/postgres"
          - title: Superuser Username
            content: "postgres"
          - title: Superuser Password
            content: "${POSTGRES_SUPERUSER_PASSWORD}"
          - title: Admin Username
            content: "admin"
          - title: Admin Password
            content: "${POSTGRES_ADMIN_PASSWORD}"
          - title: Cluster Status (run in container)
            content: "patronictl list pg-ha"

  localization:
    zh-TW:
      description: |
        ‰ΩøÁî® Patroni Âíå etcd ÁöÑÈ´òÂèØÁî® PostgreSQL Âè¢ÈõÜ„ÄÇÊèê‰æõËá™ÂãïÊïÖÈöúËΩâÁßªÂíåË§áË£ΩÂäüËÉΩÔºåÈÅ©Áî®ÊñºÁîüÁî¢Á¥öË≥áÊñôÂ∫´ÈÉ®ÁΩ≤„ÄÇ
      variables:
        - key: POSTGRES_SUPERUSER_PASSWORD
          type: PASSWORD
          name: Ë∂ÖÁ¥ö‰ΩøÁî®ËÄÖÂØÜÁ¢º
          description: PostgreSQL Ë∂ÖÁ¥ö‰ΩøÁî®ËÄÖÔºàpostgres ‰ΩøÁî®ËÄÖÔºâÁöÑÂØÜÁ¢º
        - key: POSTGRES_REPLICATION_PASSWORD
          type: PASSWORD
          name: Ë§áË£ΩÂØÜÁ¢º
          description: PostgreSQL Ë§áË£Ω‰ΩøÁî®ËÄÖÁöÑÂØÜÁ¢º
        - key: POSTGRES_ADMIN_PASSWORD
          type: PASSWORD
          name: ÁÆ°ÁêÜÂì°ÂØÜÁ¢º
          description: PostgreSQL ÁÆ°ÁêÜÂì°‰ΩøÁî®ËÄÖÁöÑÂØÜÁ¢º
      readme: |
        # PostgreSQL È´òÂèØÁî®Âè¢ÈõÜ

        Ê≠§Ê®°ÊùøÈÉ®ÁΩ≤È´òÂèØÁî® PostgreSQL Âè¢ÈõÜÔºå‰ΩøÁî®Ôºö
        - **Patroni**ÔºöÂÖ∑ÊúâËá™ÂãïÊïÖÈöúËΩâÁßªÁöÑ PostgreSQL HA Ëß£Ê±∫ÊñπÊ°à
        - **Spilo**ÔºöÁµêÂêà PostgreSQL Âíå Patroni ÁöÑ Docker Êò†ÂÉè
        - **etcd**ÔºöÂàÜÊï£ÂºèÈÖçÁΩÆÂíåÊúçÂãôÁôºÁèæ

        ## Êû∂Êßã

        - 3 ÂÄã etcd Âè¢ÈõÜÁØÄÈªûÁî®ÊñºÂàÜÊï£ÂºèÂÖ±Ë≠ò
        - 3 ÂÄã PostgreSQL ÁØÄÈªûÊê≠ÈÖç Patroni ÂØ¶ÁèæËá™ÂãïÊïÖÈöúËΩâÁßª
        - ÂÖßÂª∫Ë§áË£ΩÂíåÂÅ•Â∫∑Áõ£Êéß

        ## ÈÄ£Á∑öË≥áË®ä

        ‰ΩøÁî®‰ªªÊÑè Patroni ÁØÄÈªûÈÄ£Êé•Âè¢ÈõÜÔºö
        - **‰∏ªÊ©ü**Ôºö‰ΩøÁî® patroni1„ÄÅpatroni2 Êàñ patroni3 ÁöÑ‰∏ªÊ©üÂêçÁ®±
        - **ÈÄ£Êé•Âü†**Ôºö5432
        - **‰ΩøÁî®ËÄÖÂêçÁ®±**ÔºöpostgresÔºàË∂ÖÁ¥ö‰ΩøÁî®ËÄÖÔºâÊàñ admin
        - **ÂØÜÁ¢º**ÔºöË´ãÂú® Zeabur ÂÑÄË°®ÊùøÊü•ÁúãÁí∞Â¢ÉËÆäÊï∏

        Patroni ÊúÉËá™ÂãïÂ∞áÈÄ£Á∑öË∑ØÁî±Âà∞‰∏ªÁØÄÈªû„ÄÇ

        ### ‰ΩøÁî®ËÄÖÂ∏≥Ëôü

        | Â∏≥Ëôü | ‰ΩøÁî®ËÄÖÂêçÁ®± | Ê¨äÈôê | ‰ΩøÁî®ÊÉÖÂ¢É |
        |------|----------|------|---------|
        | **Ë∂ÖÁ¥ö‰ΩøÁî®ËÄÖ** | `postgres` | ÂÆåÊï¥Á≥ªÁµ±Ê¨äÈôê | Á≥ªÁµ±ÁÆ°ÁêÜ„ÄÅÂÇô‰ªΩ/ÈÇÑÂéü |
        | **ÁÆ°ÁêÜÂì°** | `admin` | `CREATEDB`„ÄÅ`CREATEROLE` | ÊáâÁî®Á®ãÂºèÈÄ£Á∑ö„ÄÅÊó•Â∏∏ÈñãÁôº |

        > **ÂÆâÂÖ®ÊÄß**ÔºöË´ã‰ΩøÁî® `admin` ÊàñÂª∫Á´ãÂ∞àÁî®‰ΩøÁî®ËÄÖ‰æõÊáâÁî®Á®ãÂºè‰ΩøÁî®„ÄÇÈÅøÂÖçÁõ¥Êé•‰ΩøÁî® `superuser`„ÄÇ

        ## ÂäüËÉΩÁâπËâ≤

        - **Ëá™ÂãïÊïÖÈöúËΩâÁßª**Ôºö‰∏ªÁØÄÈªûÊïÖÈöúÊôÇÔºåPatroni Ëá™ÂãïÊèêÂçáÂâØÊú¨
        - **ÂêåÊ≠•Ë§áË£Ω**ÔºöÁØÄÈªûÈñìË≥áÊñô‰∏ÄËá¥ÊÄß
        - **ÂÅ•Â∫∑Áõ£Êéß**ÔºöÊØèÂÄãÁØÄÈªûÂú® 8008 ÈÄ£Êé•Âü†Êèê‰æõ REST API
        - **ÊªæÂãïÊõ¥Êñ∞**ÔºöÁÑ°ÂÅúÊ©üÊôÇÈñìÊõ¥Êñ∞ÁØÄÈªû
        - **Ê∞¥Âπ≥Êì¥Â±ï**ÔºöËºïÈ¨ÜÊñ∞Â¢ûÊàñÁßªÈô§ÁØÄÈªû

        ## Âè¢ÈõÜË¶èÊ®°

        Ê≠§ 3 ÁØÄÈªûÈÖçÁΩÆÊèê‰æõÊ®ôÊ∫ñÁîüÁî¢Áí∞Â¢É HAÔºàÂèØÂÆπÂøç 1 ÂÄãÁØÄÈªûÊïÖÈöúÔºâ„ÄÇ

        | ÁØÄÈªûÊï∏ | ÂÆπÈåØËÉΩÂäõ | ‰ΩøÁî®ÊÉÖÂ¢É |
        |-------|---------|---------|
        | 3     | 1 ÂÄãÊïÖÈöú | ‚úÖ ÁîüÁî¢Áí∞Â¢ÉÔºàÊ®ôÊ∫ñÔºâ |
        | 5     | 2 ÂÄãÊïÖÈöú | ‚úÖ ÁîüÁî¢Áí∞Â¢ÉÔºàÈ´òÂèØÁî®Ôºâ |

        ## Êì¥Â±ïÂè¢ÈõÜ

        ### Êñ∞Â¢ûÁØÄÈªûÔºàÊì¥Â±ïËá≥ 5 ÁØÄÈªûÔºâ

        Ë¶ÅÂæû 3 ÁØÄÈªûÊì¥Â±ïËá≥ 5 ÁØÄÈªû‰ª•Áç≤ÂæóÊõ¥È´òÂèØÁî®ÊÄßÔºö

        1. **Êñ∞Â¢û etcd ÁØÄÈªû**Ôºö
           - ÈÉ®ÁΩ≤ [**etcd4**](https://zeabur.com/templates/X877ER)
           - ÈÉ®ÁΩ≤ [**etcd5**](https://zeabur.com/templates/DYGT7Y)

        2. **Êñ∞Â¢û Patroni ÁØÄÈªû**Ôºö
           - ÈÉ®ÁΩ≤ [**Patroni4**](https://zeabur.com/templates/3ZC549)
           - ÈÉ®ÁΩ≤ [**Patroni5**](https://zeabur.com/templates/LNFEJI)

        3. **Êõ¥Êñ∞ÁèæÊúâ Patroni** ÁöÑ `ETCD3_HOSTS` ‰ª•ÂåÖÂê´Êñ∞ÁöÑ etcd ÁØÄÈªûÔºö
           ```
           etcd1:2379,etcd2:2379,etcd3:2379,etcd4:2379,etcd5:2379
           ```

        ## ÁÆ°ÁêÜ

        Âú®‰ªªÊÑè Patroni ÂÆπÂô®‰∏≠Âü∑Ë°åÔºö
        ```bash
        patronictl list pg-ha
        patronictl show-config pg-ha
        ```

        ## Áõ∏ÈóúÊ®°Êùø

        - [**etcd4**](https://zeabur.com/templates/X877ER)ÔºöÊñ∞Â¢ûÁ¨¨ 4 ÂÄã etcd ÁØÄÈªû
        - [**etcd5**](https://zeabur.com/templates/DYGT7Y)ÔºöÊñ∞Â¢ûÁ¨¨ 5 ÂÄã etcd ÁØÄÈªû
        - [**Patroni4**](https://zeabur.com/templates/3ZC549)ÔºöÊñ∞Â¢ûÁ¨¨ 4 ÂÄã PostgreSQL ÁØÄÈªû
        - [**Patroni5**](https://zeabur.com/templates/LNFEJI)ÔºöÊñ∞Â¢ûÁ¨¨ 5 ÂÄã PostgreSQL ÁØÄÈªû

        ## Êñá‰ª∂

        - [ÂÆåÊï¥Ë®≠ÂÆöËàáÊì¥Â±ïÊåáÂçó](https://github.com/canyugs/zeabur-template/blob/main/postgresql-ha/README.md)
        - [Patroni Êñá‰ª∂](https://patroni.readthedocs.io/)
        - [etcd Êñá‰ª∂](https://etcd.io/docs/)

    zh-CN:
      description: |
        ‰ΩøÁî® Patroni Âíå etcd ÁöÑÈ´òÂèØÁî® PostgreSQL ÈõÜÁæ§„ÄÇÊèê‰æõËá™Âä®ÊïÖÈöúËΩ¨ÁßªÂíåÂ§çÂà∂ÂäüËÉΩÔºåÈÄÇÁî®‰∫éÁîü‰∫ßÁ∫ßÊï∞ÊçÆÂ∫ìÈÉ®ÁΩ≤„ÄÇ
      variables:
        - key: POSTGRES_SUPERUSER_PASSWORD
          type: PASSWORD
          name: Ë∂ÖÁ∫ßÁî®Êà∑ÂØÜÁ†Å
          description: PostgreSQL Ë∂ÖÁ∫ßÁî®Êà∑Ôºàpostgres Áî®Êà∑ÔºâÁöÑÂØÜÁ†Å
        - key: POSTGRES_REPLICATION_PASSWORD
          type: PASSWORD
          name: Â§çÂà∂ÂØÜÁ†Å
          description: PostgreSQL Â§çÂà∂Áî®Êà∑ÁöÑÂØÜÁ†Å
        - key: POSTGRES_ADMIN_PASSWORD
          type: PASSWORD
          name: ÁÆ°ÁêÜÂëòÂØÜÁ†Å
          description: PostgreSQL ÁÆ°ÁêÜÂëòÁî®Êà∑ÁöÑÂØÜÁ†Å
      readme: |
        # PostgreSQL È´òÂèØÁî®ÈõÜÁæ§

        Ê≠§Ê®°ÊùøÈÉ®ÁΩ≤È´òÂèØÁî® PostgreSQL ÈõÜÁæ§Ôºå‰ΩøÁî®Ôºö
        - **Patroni**ÔºöÂÖ∑ÊúâËá™Âä®ÊïÖÈöúËΩ¨ÁßªÁöÑ PostgreSQL HA Ëß£ÂÜ≥ÊñπÊ°à
        - **Spilo**ÔºöÁªìÂêà PostgreSQL Âíå Patroni ÁöÑ Docker ÈïúÂÉè
        - **etcd**ÔºöÂàÜÂ∏ÉÂºèÈÖçÁΩÆÂíåÊúçÂä°ÂèëÁé∞

        ## Êû∂ÊûÑ

        - 3 ‰∏™ etcd ÈõÜÁæ§ËäÇÁÇπÁî®‰∫éÂàÜÂ∏ÉÂºèÂÖ±ËØÜ
        - 3 ‰∏™ PostgreSQL ËäÇÁÇπÊê≠ÈÖç Patroni ÂÆûÁé∞Ëá™Âä®ÊïÖÈöúËΩ¨Áßª
        - ÂÜÖÁΩÆÂ§çÂà∂ÂíåÂÅ•Â∫∑ÁõëÊéß

        ## ËøûÊé•‰ø°ÊÅØ

        ‰ΩøÁî®‰ªªÊÑè Patroni ËäÇÁÇπËøûÊé•ÈõÜÁæ§Ôºö
        - **‰∏ªÊú∫**Ôºö‰ΩøÁî® patroni1„ÄÅpatroni2 Êàñ patroni3 ÁöÑ‰∏ªÊú∫Âêç
        - **Á´ØÂè£**Ôºö5432
        - **Áî®Êà∑Âêç**ÔºöpostgresÔºàË∂ÖÁ∫ßÁî®Êà∑ÔºâÊàñ admin
        - **ÂØÜÁ†Å**ÔºöËØ∑Âú® Zeabur ‰ª™Ë°®ÊùøÊü•ÁúãÁéØÂ¢ÉÂèòÈáè

        Patroni ‰ºöËá™Âä®Â∞ÜËøûÊé•Ë∑ØÁî±Âà∞‰∏ªËäÇÁÇπ„ÄÇ

        ### Áî®Êà∑Ë¥¶Âè∑

        | Ë¥¶Âè∑ | Áî®Êà∑Âêç | ÊùÉÈôê | ‰ΩøÁî®Âú∫ÊôØ |
        |------|-------|------|---------|
        | **Ë∂ÖÁ∫ßÁî®Êà∑** | `postgres` | ÂÆåÊï¥Á≥ªÁªüÊùÉÈôê | Á≥ªÁªüÁÆ°ÁêÜ„ÄÅÂ§á‰ªΩ/ÊÅ¢Â§ç |
        | **ÁÆ°ÁêÜÂëò** | `admin` | `CREATEDB`„ÄÅ`CREATEROLE` | Â∫îÁî®Á®ãÂ∫èËøûÊé•„ÄÅÊó•Â∏∏ÂºÄÂèë |

        > **ÂÆâÂÖ®ÊÄß**ÔºöËØ∑‰ΩøÁî® `admin` ÊàñÂàõÂª∫‰∏ìÁî®Áî®Êà∑‰æõÂ∫îÁî®Á®ãÂ∫è‰ΩøÁî®„ÄÇÈÅøÂÖçÁõ¥Êé•‰ΩøÁî® `superuser`„ÄÇ

        ## ÂäüËÉΩÁâπÊÄß

        - **Ëá™Âä®ÊïÖÈöúËΩ¨Áßª**Ôºö‰∏ªËäÇÁÇπÊïÖÈöúÊó∂ÔºåPatroni Ëá™Âä®ÊèêÂçáÂâØÊú¨
        - **ÂêåÊ≠•Â§çÂà∂**ÔºöËäÇÁÇπÈó¥Êï∞ÊçÆ‰∏ÄËá¥ÊÄß
        - **ÂÅ•Â∫∑ÁõëÊéß**ÔºöÊØè‰∏™ËäÇÁÇπÂú® 8008 Á´ØÂè£Êèê‰æõ REST API
        - **ÊªöÂä®Êõ¥Êñ∞**ÔºöÊó†ÂÅúÊú∫Êó∂Èó¥Êõ¥Êñ∞ËäÇÁÇπ
        - **Ê∞¥Âπ≥Êâ©Â±ï**ÔºöËΩªÊùæÊ∑ªÂä†ÊàñÁßªÈô§ËäÇÁÇπ

        ## ÈõÜÁæ§ËßÑÊ®°

        Ê≠§ 3 ËäÇÁÇπÈÖçÁΩÆÊèê‰æõÊ†áÂáÜÁîü‰∫ßÁéØÂ¢É HAÔºàÂèØÂÆπÂøç 1 ‰∏™ËäÇÁÇπÊïÖÈöúÔºâ„ÄÇ

        | ËäÇÁÇπÊï∞ | ÂÆπÈîôËÉΩÂäõ | ‰ΩøÁî®Âú∫ÊôØ |
        |-------|---------|---------|
        | 3     | 1 ‰∏™ÊïÖÈöú | ‚úÖ Áîü‰∫ßÁéØÂ¢ÉÔºàÊ†áÂáÜÔºâ |
        | 5     | 2 ‰∏™ÊïÖÈöú | ‚úÖ Áîü‰∫ßÁéØÂ¢ÉÔºàÈ´òÂèØÁî®Ôºâ |

        ## Êâ©Â±ïÈõÜÁæ§

        ### Ê∑ªÂä†ËäÇÁÇπÔºàÊâ©Â±ïËá≥ 5 ËäÇÁÇπÔºâ

        Ë¶Å‰ªé 3 ËäÇÁÇπÊâ©Â±ïËá≥ 5 ËäÇÁÇπ‰ª•Ëé∑ÂæóÊõ¥È´òÂèØÁî®ÊÄßÔºö

        1. **Ê∑ªÂä† etcd ËäÇÁÇπ**Ôºö
           - ÈÉ®ÁΩ≤ [**etcd4**](https://zeabur.com/templates/X877ER)
           - ÈÉ®ÁΩ≤ [**etcd5**](https://zeabur.com/templates/DYGT7Y)

        2. **Ê∑ªÂä† Patroni ËäÇÁÇπ**Ôºö
           - ÈÉ®ÁΩ≤ [**Patroni4**](https://zeabur.com/templates/3ZC549)
           - ÈÉ®ÁΩ≤ [**Patroni5**](https://zeabur.com/templates/LNFEJI)

        3. **Êõ¥Êñ∞Áé∞Êúâ Patroni** ÁöÑ `ETCD3_HOSTS` ‰ª•ÂåÖÂê´Êñ∞ÁöÑ etcd ËäÇÁÇπÔºö
           ```
           etcd1:2379,etcd2:2379,etcd3:2379,etcd4:2379,etcd5:2379
           ```

        ## ÁÆ°ÁêÜ

        Âú®‰ªªÊÑè Patroni ÂÆπÂô®‰∏≠ÊâßË°åÔºö
        ```bash
        patronictl list pg-ha
        patronictl show-config pg-ha
        ```

        ## Áõ∏ÂÖ≥Ê®°Êùø

        - [**etcd4**](https://zeabur.com/templates/X877ER)ÔºöÊ∑ªÂä†Á¨¨ 4 ‰∏™ etcd ËäÇÁÇπ
        - [**etcd5**](https://zeabur.com/templates/DYGT7Y)ÔºöÊ∑ªÂä†Á¨¨ 5 ‰∏™ etcd ËäÇÁÇπ
        - [**Patroni4**](https://zeabur.com/templates/3ZC549)ÔºöÊ∑ªÂä†Á¨¨ 4 ‰∏™ PostgreSQL ËäÇÁÇπ
        - [**Patroni5**](https://zeabur.com/templates/LNFEJI)ÔºöÊ∑ªÂä†Á¨¨ 5 ‰∏™ PostgreSQL ËäÇÁÇπ

        ## ÊñáÊ°£

        - [ÂÆåÊï¥ËÆæÁΩÆ‰∏éÊâ©Â±ïÊåáÂçó](https://github.com/canyugs/zeabur-template/blob/main/postgresql-ha/README.md)
        - [Patroni ÊñáÊ°£](https://patroni.readthedocs.io/)
        - [etcd ÊñáÊ°£](https://etcd.io/docs/)

    ja-JP:
      description: |
        Patroni „Å® etcd „Çí‰ΩøÁî®„Åó„ÅüÈ´òÂèØÁî®ÊÄß PostgreSQL „ÇØ„É©„Çπ„Çø„Éº„ÄÇÊú¨Áï™„Ç∞„É¨„Éº„Éâ„ÅÆ„Éá„Éº„Çø„Éô„Éº„Çπ„Éá„Éó„É≠„Ç§„É°„É≥„ÉàÂêë„Åë„Å´Ëá™Âãï„Éï„Çß„Ç§„É´„Ç™„Éº„Éê„Éº„Å®„É¨„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÇíÊèê‰æõ„Åó„Åæ„Åô„ÄÇ
      variables:
        - key: POSTGRES_SUPERUSER_PASSWORD
          type: PASSWORD
          name: „Çπ„Éº„Éë„Éº„É¶„Éº„Ç∂„Éº„Éë„Çπ„ÉØ„Éº„Éâ
          description: PostgreSQL „Çπ„Éº„Éë„Éº„É¶„Éº„Ç∂„ÉºÔºàpostgres „É¶„Éº„Ç∂„ÉºÔºâ„ÅÆ„Éë„Çπ„ÉØ„Éº„Éâ
        - key: POSTGRES_REPLICATION_PASSWORD
          type: PASSWORD
          name: „É¨„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Éë„Çπ„ÉØ„Éº„Éâ
          description: PostgreSQL „É¨„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„É¶„Éº„Ç∂„Éº„ÅÆ„Éë„Çπ„ÉØ„Éº„Éâ
        - key: POSTGRES_ADMIN_PASSWORD
          type: PASSWORD
          name: ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ
          description: PostgreSQL ÁÆ°ÁêÜËÄÖ„É¶„Éº„Ç∂„Éº„ÅÆ„Éë„Çπ„ÉØ„Éº„Éâ
      readme: |
        # PostgreSQL È´òÂèØÁî®ÊÄß„ÇØ„É©„Çπ„Çø„Éº

        „Åì„ÅÆ„ÉÜ„É≥„Éó„É¨„Éº„Éà„ÅØ‰ª•‰∏ã„Çí‰ΩøÁî®„Åó„Å¶È´òÂèØÁî®ÊÄß PostgreSQL „ÇØ„É©„Çπ„Çø„Éº„Çí„Éá„Éó„É≠„Ç§„Åó„Åæ„ÅôÔºö
        - **Patroni**ÔºöËá™Âãï„Éï„Çß„Ç§„É´„Ç™„Éº„Éê„ÉºÊ©üËÉΩ„ÇíÊåÅ„Å§ PostgreSQL HA „ÇΩ„É™„É•„Éº„Ç∑„Éß„É≥
        - **Spilo**ÔºöPostgreSQL „Å® Patroni „ÇíÁµÑ„ÅøÂêà„Çè„Åõ„Åü Docker „Ç§„É°„Éº„Ç∏
        - **etcd**ÔºöÂàÜÊï£Ë®≠ÂÆö„Å®„Çµ„Éº„Éì„Çπ„Éá„Ç£„Çπ„Ç´„Éê„É™

        ## „Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£

        - ÂàÜÊï£„Ç≥„É≥„Çª„É≥„Çµ„ÇπÁî®„ÅÆ 3 „Å§„ÅÆ etcd „ÇØ„É©„Çπ„Çø„Éº„Éé„Éº„Éâ
        - Ëá™Âãï„Éï„Çß„Ç§„É´„Ç™„Éº„Éê„ÉºÁî®„ÅÆ Patroni „ÇíÂÇô„Åà„Åü 3 „Å§„ÅÆ PostgreSQL „Éé„Éº„Éâ
        - ÁµÑ„ÅøËæº„Åø„ÅÆ„É¨„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Å®„Éò„É´„Çπ„É¢„Éã„Çø„É™„É≥„Ç∞

        ## Êé•Á∂öÊÉÖÂ†±

        ‰ªªÊÑè„ÅÆ Patroni „Éé„Éº„Éâ„Çí‰ΩøÁî®„Åó„Å¶„ÇØ„É©„Çπ„Çø„Éº„Å´Êé•Á∂öÔºö
        - **„Éõ„Çπ„Éà**Ôºöpatroni1„ÄÅpatroni2„ÄÅ„Åæ„Åü„ÅØ patroni3 „ÅÆ„Éõ„Çπ„ÉàÂêç„Çí‰ΩøÁî®
        - **„Éù„Éº„Éà**Ôºö5432
        - **„É¶„Éº„Ç∂„ÉºÂêç**ÔºöpostgresÔºà„Çπ„Éº„Éë„Éº„É¶„Éº„Ç∂„ÉºÔºâ„Åæ„Åü„ÅØ admin
        - **„Éë„Çπ„ÉØ„Éº„Éâ**ÔºöZeabur „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„ÅÆÁí∞Â¢ÉÂ§âÊï∞„ÇíÁ¢∫Ë™ç

        Patroni „ÅØËá™ÂãïÁöÑ„Å´Êé•Á∂ö„Çí„Éû„Çπ„Çø„Éº„Éé„Éº„Éâ„Å´„É´„Éº„ÉÜ„Ç£„É≥„Ç∞„Åó„Åæ„Åô„ÄÇ

        ### „É¶„Éº„Ç∂„Éº„Ç¢„Ç´„Ç¶„É≥„Éà

        | „Ç¢„Ç´„Ç¶„É≥„Éà | „É¶„Éº„Ç∂„ÉºÂêç | Ê®©Èôê | ‰ΩøÁî®„Ç±„Éº„Çπ |
        |----------|----------|------|----------|
        | **„Çπ„Éº„Éë„Éº„É¶„Éº„Ç∂„Éº** | `postgres` | ÂÆåÂÖ®„Å™„Ç∑„Çπ„ÉÜ„É†Ê®©Èôê | „Ç∑„Çπ„ÉÜ„É†ÁÆ°ÁêÜ„ÄÅ„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó/„É™„Çπ„Éà„Ç¢ |
        | **ÁÆ°ÁêÜËÄÖ** | `admin` | `CREATEDB`„ÄÅ`CREATEROLE` | „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥Êé•Á∂ö„ÄÅÊó•Â∏∏ÈñãÁô∫ |

        > **„Çª„Ç≠„É•„É™„ÉÜ„Ç£**Ôºö„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Å´„ÅØ `admin` „Åæ„Åü„ÅØÂ∞ÇÁî®„É¶„Éº„Ç∂„Éº„Çí‰ΩøÁî®„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

        ## Ê©üËÉΩ

        - **Ëá™Âãï„Éï„Çß„Ç§„É´„Ç™„Éº„Éê„Éº**Ôºö„Éû„Çπ„Çø„ÉºÈöúÂÆ≥ÊôÇ„Å´ Patroni „ÅåËá™ÂãïÁöÑ„Å´„É¨„Éó„É™„Ç´„ÇíÊòáÊ†º
        - **ÂêåÊúü„É¨„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥**Ôºö„Éé„Éº„ÉâÈñì„ÅÆ„Éá„Éº„ÇøÊï¥ÂêàÊÄß
        - **„Éò„É´„Çπ„É¢„Éã„Çø„É™„É≥„Ç∞**ÔºöÂêÑ„Éé„Éº„Éâ„ÅÆ„Éù„Éº„Éà 8008 „Åß REST API „ÇíÊèê‰æõ
        - **„É≠„Éº„É™„É≥„Ç∞„Ç¢„ÉÉ„Éó„Éá„Éº„Éà**Ôºö„ÉÄ„Ç¶„É≥„Çø„Ç§„É†„Å™„Åó„Åß„Éé„Éº„Éâ„ÇíÊõ¥Êñ∞
        - **Ê∞¥Âπ≥„Çπ„Ç±„Éº„É™„É≥„Ç∞**Ôºö„Éé„Éº„Éâ„ÅÆËøΩÂä†„ÉªÂâäÈô§„ÅåÂÆπÊòì

        ## „ÇØ„É©„Çπ„Çø„Éº„Çµ„Ç§„Ç∫

        „Åì„ÅÆ 3 „Éé„Éº„ÉâÊßãÊàê„ÅØÊ®ôÊ∫ñÁöÑ„Å™Êú¨Áï™Áí∞Â¢É HA „ÇíÊèê‰æõ„Åó„Åæ„ÅôÔºà1 „Éé„Éº„ÉâÈöúÂÆ≥„ÇíË®±ÂÆπÔºâ„ÄÇ

        | „Éé„Éº„ÉâÊï∞ | ÈöúÂÆ≥ËÄêÊÄß | ‰ΩøÁî®„Ç±„Éº„Çπ |
        |---------|---------|----------|
        | 3       | 1 ÈöúÂÆ≥   | ‚úÖ Êú¨Áï™Áí∞Â¢ÉÔºàÊ®ôÊ∫ñÔºâ |
        | 5       | 2 ÈöúÂÆ≥   | ‚úÖ Êú¨Áï™Áí∞Â¢ÉÔºàÈ´òÂèØÁî®ÊÄßÔºâ |

        ## „ÇØ„É©„Çπ„Çø„Éº„ÅÆ„Çπ„Ç±„Éº„É™„É≥„Ç∞

        ### „Éé„Éº„Éâ„ÅÆËøΩÂä†Ôºà5 „Éé„Éº„Éâ„Å∏„ÅÆÊã°ÂºµÔºâ

        „Çà„ÇäÈ´ò„ÅÑÂèØÁî®ÊÄß„ÅÆ„Åü„ÇÅ„Å´ 3 „Éé„Éº„Éâ„Åã„Çâ 5 „Éé„Éº„Éâ„Å´„Çπ„Ç±„Éº„É´„Åô„Çã„Å´„ÅØÔºö

        1. **etcd „Éé„Éº„Éâ„ÇíËøΩÂä†**Ôºö
           - [**etcd4**](https://zeabur.com/templates/X877ER) „Çí„Éá„Éó„É≠„Ç§
           - [**etcd5**](https://zeabur.com/templates/DYGT7Y) „Çí„Éá„Éó„É≠„Ç§

        2. **Patroni „Éé„Éº„Éâ„ÇíËøΩÂä†**Ôºö
           - [**Patroni4**](https://zeabur.com/templates/3ZC549) „Çí„Éá„Éó„É≠„Ç§
           - [**Patroni5**](https://zeabur.com/templates/LNFEJI) „Çí„Éá„Éó„É≠„Ç§

        3. **Êó¢Â≠ò„ÅÆ Patroni** „ÅÆ `ETCD3_HOSTS` „ÇíÊõ¥Êñ∞Ôºö
           ```
           etcd1:2379,etcd2:2379,etcd3:2379,etcd4:2379,etcd5:2379
           ```

        ## ÁÆ°ÁêÜ

        ‰ªªÊÑè„ÅÆ Patroni „Ç≥„É≥„ÉÜ„ÉäÂÜÖ„ÅßÂÆüË°åÔºö
        ```bash
        patronictl list pg-ha
        patronictl show-config pg-ha
        ```

        ## Èñ¢ÈÄ£„ÉÜ„É≥„Éó„É¨„Éº„Éà

        - [**etcd4**](https://zeabur.com/templates/X877ER)Ôºö4 Áï™ÁõÆ„ÅÆ etcd „Éé„Éº„Éâ„ÇíËøΩÂä†
        - [**etcd5**](https://zeabur.com/templates/DYGT7Y)Ôºö5 Áï™ÁõÆ„ÅÆ etcd „Éé„Éº„Éâ„ÇíËøΩÂä†
        - [**Patroni4**](https://zeabur.com/templates/3ZC549)Ôºö4 Áï™ÁõÆ„ÅÆ PostgreSQL „Éé„Éº„Éâ„ÇíËøΩÂä†
        - [**Patroni5**](https://zeabur.com/templates/LNFEJI)Ôºö5 Áï™ÁõÆ„ÅÆ PostgreSQL „Éé„Éº„Éâ„ÇíËøΩÂä†

        ## „Éâ„Ç≠„É•„É°„É≥„Éà

        - [ÂÆåÂÖ®„Å™„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó„Å®„Çπ„Ç±„Éº„É™„É≥„Ç∞„Ç¨„Ç§„Éâ](https://github.com/canyugs/zeabur-template/blob/main/postgresql-ha/README.md)
        - [Patroni „Éâ„Ç≠„É•„É°„É≥„Éà](https://patroni.readthedocs.io/)
        - [etcd „Éâ„Ç≠„É•„É°„É≥„Éà](https://etcd.io/docs/)

    es-ES:
      description: |
        Cl√∫ster PostgreSQL de alta disponibilidad con Patroni y etcd. Proporciona conmutaci√≥n por error autom√°tica y replicaci√≥n para implementaciones de bases de datos de nivel de producci√≥n.
      variables:
        - key: POSTGRES_SUPERUSER_PASSWORD
          type: PASSWORD
          name: Contrase√±a de superusuario
          description: Contrase√±a para el superusuario de PostgreSQL (usuario postgres)
        - key: POSTGRES_REPLICATION_PASSWORD
          type: PASSWORD
          name: Contrase√±a de replicaci√≥n
          description: Contrase√±a para el usuario de replicaci√≥n de PostgreSQL
        - key: POSTGRES_ADMIN_PASSWORD
          type: PASSWORD
          name: Contrase√±a de administrador
          description: Contrase√±a para el usuario administrador de PostgreSQL
      readme: |
        # Cl√∫ster PostgreSQL de Alta Disponibilidad

        Esta plantilla despliega un cl√∫ster PostgreSQL de alta disponibilidad usando:
        - **Patroni**: Soluci√≥n PostgreSQL HA con conmutaci√≥n por error autom√°tica
        - **Spilo**: Imagen Docker que combina PostgreSQL y Patroni
        - **etcd**: Configuraci√≥n distribuida y descubrimiento de servicios

        ## Arquitectura

        - 3 nodos de cl√∫ster etcd para consenso distribuido
        - 3 nodos PostgreSQL con Patroni para conmutaci√≥n por error autom√°tica
        - Replicaci√≥n y monitoreo de salud integrados

        ## Informaci√≥n de Conexi√≥n

        Use cualquier nodo Patroni para conectarse al cl√∫ster:
        - **Host**: Use el nombre de host de patroni1, patroni2 o patroni3
        - **Puerto**: 5432
        - **Usuario**: postgres (superusuario) o admin
        - **Contrase√±a**: Verifique las variables de entorno en el panel de Zeabur

        Patroni enrutar√° autom√°ticamente las conexiones al nodo maestro.

        ### Cuentas de Usuario

        | Cuenta | Usuario | Privilegios | Caso de Uso |
        |--------|---------|-------------|-------------|
        | **Superusuario** | `postgres` | Privilegios completos | Administraci√≥n del sistema |
        | **Administrador** | `admin` | `CREATEDB`, `CREATEROLE` | Conexiones de aplicaciones |

        > **Seguridad**: Use `admin` o cree usuarios dedicados para aplicaciones.

        ## Caracter√≠sticas

        - **Conmutaci√≥n por error autom√°tica**: Si el maestro falla, Patroni promueve una r√©plica
        - **Replicaci√≥n s√≠ncrona**: Consistencia de datos entre nodos
        - **Monitoreo de salud**: API REST en el puerto 8008 para cada nodo
        - **Actualizaciones continuas**: Actualice nodos sin tiempo de inactividad
        - **Escalado horizontal**: Agregue o elimine nodos f√°cilmente

        ## Tama√±o del Cl√∫ster

        Esta configuraci√≥n de 3 nodos proporciona HA est√°ndar de producci√≥n.

        | Nodos | Tolerancia a fallos | Caso de Uso |
        |-------|-------------------|-------------|
        | 3     | 1 fallo           | ‚úÖ Producci√≥n (est√°ndar) |
        | 5     | 2 fallos          | ‚úÖ Producci√≥n (alta disponibilidad) |

        ## Escalado del Cl√∫ster

        ### Agregar Nodos (Escalar a 5 Nodos)

        1. **Agregar nodos etcd**:
           - Despliegue [**etcd4**](https://zeabur.com/templates/X877ER)
           - Despliegue [**etcd5**](https://zeabur.com/templates/DYGT7Y)

        2. **Agregar nodos Patroni**:
           - Despliegue [**Patroni4**](https://zeabur.com/templates/3ZC549)
           - Despliegue [**Patroni5**](https://zeabur.com/templates/LNFEJI)

        3. **Actualice** `ETCD3_HOSTS` **de Patroni existente**:
           ```
           etcd1:2379,etcd2:2379,etcd3:2379,etcd4:2379,etcd5:2379
           ```

        ## Administraci√≥n

        Ejecute dentro de cualquier contenedor Patroni:
        ```bash
        patronictl list pg-ha
        patronictl show-config pg-ha
        ```

        ## Plantillas Relacionadas

        - [**etcd4**](https://zeabur.com/templates/X877ER): Agregar 4¬∫ nodo etcd
        - [**etcd5**](https://zeabur.com/templates/DYGT7Y): Agregar 5¬∫ nodo etcd
        - [**Patroni4**](https://zeabur.com/templates/3ZC549): Agregar 4¬∫ nodo PostgreSQL
        - [**Patroni5**](https://zeabur.com/templates/LNFEJI): Agregar 5¬∫ nodo PostgreSQL

        ## Documentaci√≥n

        - [Gu√≠a completa](https://github.com/canyugs/zeabur-template/blob/main/postgresql-ha/README.md)
        - [Documentaci√≥n de Patroni](https://patroni.readthedocs.io/)
        - [Documentaci√≥n de etcd](https://etcd.io/docs/)

    id-ID:
      description: |
        Kluster PostgreSQL dengan ketersediaan tinggi menggunakan Patroni dan etcd. Menyediakan failover otomatis dan replikasi untuk deployment database tingkat produksi.
      variables:
        - key: POSTGRES_SUPERUSER_PASSWORD
          type: PASSWORD
          name: Kata Sandi Superuser
          description: Kata sandi untuk superuser PostgreSQL (pengguna postgres)
        - key: POSTGRES_REPLICATION_PASSWORD
          type: PASSWORD
          name: Kata Sandi Replikasi
          description: Kata sandi untuk pengguna replikasi PostgreSQL
        - key: POSTGRES_ADMIN_PASSWORD
          type: PASSWORD
          name: Kata Sandi Admin
          description: Kata sandi untuk pengguna admin PostgreSQL
      readme: |
        # Kluster PostgreSQL Ketersediaan Tinggi

        Template ini mendeploy kluster PostgreSQL dengan ketersediaan tinggi menggunakan:
        - **Patroni**: Solusi PostgreSQL HA dengan failover otomatis
        - **Spilo**: Image Docker yang menggabungkan PostgreSQL dan Patroni
        - **etcd**: Konfigurasi terdistribusi dan penemuan layanan

        ## Arsitektur

        - 3 node kluster etcd untuk konsensus terdistribusi
        - 3 node PostgreSQL dengan Patroni untuk failover otomatis
        - Replikasi dan pemantauan kesehatan bawaan

        ## Informasi Koneksi

        Gunakan salah satu node Patroni untuk terhubung ke kluster:
        - **Host**: Gunakan hostname dari patroni1, patroni2, atau patroni3
        - **Port**: 5432
        - **Username**: postgres (superuser) atau admin
        - **Password**: Periksa variabel lingkungan di dashboard Zeabur

        Patroni akan secara otomatis merutekan koneksi ke node master.

        ### Akun Pengguna

        | Akun | Username | Hak Akses | Kasus Penggunaan |
        |------|----------|-----------|------------------|
        | **Superuser** | `postgres` | Hak akses sistem penuh | Administrasi sistem |
        | **Admin** | `admin` | `CREATEDB`, `CREATEROLE` | Koneksi aplikasi |

        > **Keamanan**: Gunakan `admin` atau buat pengguna khusus untuk aplikasi.

        ## Fitur

        - **Failover Otomatis**: Jika master gagal, Patroni mempromosikan replika
        - **Replikasi Sinkron**: Konsistensi data antar node
        - **Pemantauan Kesehatan**: REST API di port 8008 untuk setiap node
        - **Pembaruan Bergulir**: Perbarui node tanpa downtime
        - **Penskalaan Horizontal**: Tambah atau hapus node dengan mudah

        ## Ukuran Kluster

        Konfigurasi 3 node ini menyediakan HA standar produksi.

        | Node | Toleransi Kegagalan | Kasus Penggunaan |
        |------|---------------------|------------------|
        | 3    | 1 kegagalan         | ‚úÖ Produksi (standar) |
        | 5    | 2 kegagalan         | ‚úÖ Produksi (ketersediaan tinggi) |

        ## Penskalaan Kluster

        ### Menambah Node (Skala ke 5 Node)

        1. **Tambah node etcd**:
           - Deploy [**etcd4**](https://zeabur.com/templates/X877ER)
           - Deploy [**etcd5**](https://zeabur.com/templates/DYGT7Y)

        2. **Tambah node Patroni**:
           - Deploy [**Patroni4**](https://zeabur.com/templates/3ZC549)
           - Deploy [**Patroni5**](https://zeabur.com/templates/LNFEJI)

        3. **Perbarui** `ETCD3_HOSTS` **Patroni yang ada**:
           ```
           etcd1:2379,etcd2:2379,etcd3:2379,etcd4:2379,etcd5:2379
           ```

        ## Manajemen

        Jalankan di dalam kontainer Patroni mana pun:
        ```bash
        patronictl list pg-ha
        patronictl show-config pg-ha
        ```

        ## Template Terkait

        - [**etcd4**](https://zeabur.com/templates/X877ER): Tambah node etcd ke-4
        - [**etcd5**](https://zeabur.com/templates/DYGT7Y): Tambah node etcd ke-5
        - [**Patroni4**](https://zeabur.com/templates/3ZC549): Tambah node PostgreSQL ke-4
        - [**Patroni5**](https://zeabur.com/templates/LNFEJI): Tambah node PostgreSQL ke-5

        ## Dokumentasi

        - [Panduan Lengkap](https://github.com/canyugs/zeabur-template/blob/main/postgresql-ha/README.md)
        - [Dokumentasi Patroni](https://patroni.readthedocs.io/)
        - [Dokumentasi etcd](https://etcd.io/docs/)