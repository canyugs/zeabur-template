# yaml-language-server: $schema=https://schema.zeabur.app/template.json
apiVersion: zeabur.com/v1
kind: Template
metadata:
  name: Patroni PostgreSQL (Single node for postgresql-ha)
spec:
  description: |
    Add additional Patroni nodes to an existing PostgreSQL HA cluster. Use this to scale your cluster horizontally or replace failed nodes.
  icon: https://raw.githubusercontent.com/zeabur/service-icons/main/marketplace/postgresql.svg
  coverImage: https://kinsta.com/wp-content/uploads/2022/03/what-is-postgresql.png
  tags:
    - Database
    - PostgreSQL 
    - Patroni
    - High Availability
  variables:
    - key: PATRONI_SCOPE
      type: STRING
      name: Cluster Scope
      description: Patroni cluster name (must match existing cluster if joining)
    - key: PATRONI_NODE_NAME
      type: STRING
      name: Node Name
      description: Unique name for this Patroni node (e.g., patroni4, patroni5)
    - key: ETCD_HOST
      type: STRING
      name: etcd Host
      description: etcd server hostname or IP address (without port)
    - key: ETCD_PORT
      type: STRING
      name: etcd Port
      description: etcd client port (default 2379)
    - key: POSTGRES_SUPERUSER_PASSWORD
      type: PASSWORD
      name: Superuser Password
      description: Password for PostgreSQL superuser (postgres user)
    - key: POSTGRES_REPLICATION_PASSWORD
      type: PASSWORD
      name: Replication Password
      description: Password for PostgreSQL replication user
    - key: POSTGRES_ADMIN_PASSWORD
      type: PASSWORD
      name: Admin Password
      description: Password for PostgreSQL admin user
  readme: |
    # Patroni PostgreSQL Node (Cluster Expansion)

    This template allows you to add additional Patroni nodes to an existing PostgreSQL HA cluster. Use this to scale your cluster horizontally or replace failed nodes.

    ## ğŸ¯ Designed For

    This template is specifically designed to expand the **[PostgreSQL HA](https://zeabur.com/zh-TW/templates/IOYTRN)** template cluster.

    If you haven't deployed the base cluster yet, please deploy the [PostgreSQL HA template](https://zeabur.com/zh-TW/templates/IOYTRN) first.

    ## Use Cases

    1. **Expand existing HA cluster**: Add more replicas for higher availability or read scaling
    2. **Replace failed node**: Deploy a new node to replace a failed cluster member
    3. **Standalone deployment**: Create an independent single-node PostgreSQL instance

    ## Prerequisites

    - **Existing etcd service**: You must have an etcd instance running and accessible
    - **Cluster information**: If joining an existing cluster, you need to know:
      - Cluster scope name (e.g., `pg-ha`)
      - Existing node names (to avoid conflicts)
      - Cluster passwords (must match existing cluster)

    ## Configuration Variables

    ### Cluster Identity

    - **Cluster Scope**: The Patroni cluster name
      - **Join existing cluster**: Use the same scope as existing nodes (e.g., `pg-ha`)
      - **New standalone**: Use a unique scope name (e.g., `my-postgres`)

    - **Node Name**: Unique identifier for this Patroni node
      - **Must be unique** within the same cluster scope
      - Examples: `patroni4`, `patroni5`, `replica-1`, etc.
      - **Avoid conflicts**: Check existing node names before deploying

    ### etcd Connection

    - **etcd Host**: Hostname or IP of your etcd service (without port)
    - **etcd Port**: etcd client port (default: `2379`)

    ### Authentication

    - **Passwords must match existing cluster** if joining
    - Three password types:
      - **Superuser**: Full PostgreSQL admin access
      - **Replication**: Used for data replication between nodes
      - **Admin**: Application-level admin user

    ## Example: Adding to Existing HA Cluster

    If you deployed the [PostgreSQL HA template](https://zeabur.com/zh-TW/templates/IOYTRN):

    ```
    Cluster Scope: pg-ha              # Match existing cluster
    Node Name: patroni4               # New unique name
    etcd Host: etcd1:2379,etcd2:2379,etcd3:2379   # Your existing etcd services
    etcd Port: 2379
    [Use same passwords as existing cluster]
    ```

    ## Example: Standalone Deployment

    For an independent PostgreSQL instance:

    ```
    Cluster Scope: my-app-db          # New cluster name
    Node Name: patroni                # Any unique name
    etcd Host: my-etcd                # Your etcd service
    etcd Port: 2379
    [Set your own passwords]
    ```

    ## How It Works

    1. Node connects to etcd and registers with the cluster scope
    2. If joining existing cluster:
       - Discovers master node via etcd
       - Performs basebackup to replicate data
       - Starts following master as replica
    3. If creating new cluster:
       - Initializes as master
       - Waits for other nodes to join

    ## Connection Information

    After deployment, use the connection details from the Instructions tab:

    - **Database Port**: 5432
    - **Management API**: Port 8008 (for health checks)
    - **Users**: postgres (superuser), admin, replicator

    ## Management API

    Check node status via REST API:
    - Health: `http://<node-hostname>:8008/health`
    - Role: `http://<node-hostname>:8008/master` or `/replica`
    - Config: `http://<node-hostname>:8008/config`

    ## Important Notes

    âš ï¸ **Unique Node Names**: Each node in the same scope must have a different name

    âš ï¸ **Password Consistency**: When joining an existing cluster, passwords must match exactly

    âš ï¸ **Network Access**: Ensure the new node can reach etcd and existing cluster nodes

    ## Documentation

    - [Patroni Documentation](https://patroni.readthedocs.io/)
    - [PostgreSQL Documentation](https://www.postgresql.org/docs/)

  services:
    - name: patroni
      icon: https://raw.githubusercontent.com/zeabur/service-icons/main/marketplace/postgresql.svg
      template: PREBUILT
      spec:
        instructions:
          - title: Database Host
            content: "${CONTAINER_HOSTNAME}"
          - title: Database Port
            content: "5432"
          - title: Superuser Username
            content: "postgres"
          - title: Superuser Password
            content: "${POSTGRES_SUPERUSER_PASSWORD}"
          - title: Admin Username
            content: "admin"
          - title: Admin Password
            content: "${POSTGRES_ADMIN_PASSWORD}"
          - title: Superuser Connection String
            content: "postgresql://postgres:${POSTGRES_SUPERUSER_PASSWORD}@${CONTAINER_HOSTNAME}:5432/postgres"
          - title: Admin Connection String
            content: "postgresql://admin:${POSTGRES_ADMIN_PASSWORD}@${CONTAINER_HOSTNAME}:5432/postgres"
          - title: Health Check API
            content: "http://${CONTAINER_HOSTNAME}:8008/health"
        source:
          image: ghcr.io/zalando/spilo-15:3.2-p1
          command:
            - sh
            - -c
            - |
              # Wrapper to fix ownership after basebackup
              (
                while sleep 10; do
                  if [ -d /home/postgres/pgdata/pgroot ]; then
                    chown -R postgres:postgres /home/postgres/pgdata/pgroot 2>/dev/null || true
                  fi
                done
              ) &
              exec /launch.sh init
        ports:
          - id: database
            port: 5432
            type: TCP
          - id: api
            port: 8008
            type: HTTP
        healthCheck:
          type: HTTP
          port: api
          http:
            path: /health
        volumes:
          - id: data
            dir: /home/postgres/pgdata
        env:
          SCOPE:
            default: ${PATRONI_SCOPE}
          PATRONI_NAME:
            default: ${PATRONI_NODE_NAME}
          PATRONI_RESTAPI_LISTEN:
            default: 0.0.0.0:8008
          PATRONI_RESTAPI_CONNECT_ADDRESS:
            default: ${CONTAINER_HOSTNAME}:8008
          PATRONI_POSTGRESQL_LISTEN:
            default: 0.0.0.0:5432
          PATRONI_POSTGRESQL_CONNECT_ADDRESS:
            default: ${CONTAINER_HOSTNAME}:5432
          PATRONI_SUPERUSER_USERNAME:
            default: postgres
          PATRONI_SUPERUSER_PASSWORD:
            default: ${POSTGRES_SUPERUSER_PASSWORD}
          PATRONI_REPLICATION_USERNAME:
            default: replicator
          PATRONI_REPLICATION_PASSWORD:
            default: ${POSTGRES_REPLICATION_PASSWORD}
          PATRONI_admin_USERNAME:
            default: admin
          PATRONI_admin_PASSWORD:
            default: ${POSTGRES_ADMIN_PASSWORD}
          PGPASSWORD_SUPERUSER:
            default: ${POSTGRES_SUPERUSER_PASSWORD}
          PGPASSWORD_STANDBY:
            default: ${POSTGRES_REPLICATION_PASSWORD}
          PGPASSWORD_ADMIN:
            default: ${POSTGRES_ADMIN_PASSWORD}
          DCS_TYPE:
            default: etcd
          PATRONI_ETCD_HOSTS:
            default: ${ETCD_HOST}:${ETCD_PORT}
          ETCD_HOSTS:
            default: ${ETCD_HOST}:${ETCD_PORT}

  localization:
    zh-TW:
      description: |
        å°‡é¡å¤–çš„ Patroni ç¯€é»æ–°å¢åˆ°ç¾æœ‰çš„ PostgreSQL HA å¢é›†ã€‚ä½¿ç”¨æ­¤æ¨¡æ¿ä¾†æ°´å¹³æ“´å±•å¢é›†æˆ–æ›¿æ›æ•…éšœç¯€é»ã€‚
      variables:
        - key: PATRONI_SCOPE
          type: STRING
          name: å¢é›†ç¯„åœ
          description: Patroni å¢é›†åç¨±ï¼ˆåŠ å…¥ç¾æœ‰å¢é›†æ™‚å¿…é ˆç›¸ç¬¦ï¼‰
        - key: PATRONI_NODE_NAME
          type: STRING
          name: ç¯€é»åç¨±
          description: æ­¤ Patroni ç¯€é»çš„å”¯ä¸€åç¨±ï¼ˆä¾‹å¦‚ patroni4ã€patroni5ï¼‰
        - key: ETCD_HOST
          type: STRING
          name: etcd ä¸»æ©Ÿ
          description: etcd ä¼ºæœå™¨ä¸»æ©Ÿåç¨±æˆ– IP ä½å€ï¼ˆä¸å«é€£æ¥åŸ ï¼‰
        - key: ETCD_PORT
          type: STRING
          name: etcd é€£æ¥åŸ 
          description: etcd å®¢æˆ¶ç«¯é€£æ¥åŸ ï¼ˆé è¨­ 2379ï¼‰
        - key: POSTGRES_SUPERUSER_PASSWORD
          type: PASSWORD
          name: è¶…ç´šä½¿ç”¨è€…å¯†ç¢¼
          description: PostgreSQL è¶…ç´šä½¿ç”¨è€…ï¼ˆpostgres ä½¿ç”¨è€…ï¼‰çš„å¯†ç¢¼
        - key: POSTGRES_REPLICATION_PASSWORD
          type: PASSWORD
          name: è¤‡è£½å¯†ç¢¼
          description: PostgreSQL è¤‡è£½ä½¿ç”¨è€…çš„å¯†ç¢¼
        - key: POSTGRES_ADMIN_PASSWORD
          type: PASSWORD
          name: ç®¡ç†å“¡å¯†ç¢¼
          description: PostgreSQL ç®¡ç†å“¡ä½¿ç”¨è€…çš„å¯†ç¢¼
      readme: |
        # Patroni PostgreSQL ç¯€é»ï¼ˆå¢é›†æ“´å±•ï¼‰

        æ­¤æ¨¡æ¿å…è¨±æ‚¨å°‡é¡å¤–çš„ Patroni ç¯€é»æ–°å¢åˆ°ç¾æœ‰çš„ PostgreSQL HA å¢é›†ã€‚

        ## ä½¿ç”¨å ´æ™¯

        1. **æ“´å±•ç¾æœ‰ HA å¢é›†**ï¼šæ–°å¢æ›´å¤šå‰¯æœ¬ä»¥ç²å¾—æ›´é«˜å¯ç”¨æ€§æˆ–è®€å–æ“´å±•
        2. **æ›¿æ›æ•…éšœç¯€é»**ï¼šéƒ¨ç½²æ–°ç¯€é»ä»¥æ›¿æ›æ•…éšœçš„å¢é›†æˆå“¡

        ## å…ˆæ±ºæ¢ä»¶

        - **ç¾æœ‰çš„ etcd æœå‹™**ï¼šæ‚¨å¿…é ˆæœ‰ä¸€å€‹æ­£åœ¨åŸ·è¡Œä¸”å¯å­˜å–çš„ etcd å¯¦ä¾‹
        - **å¢é›†è³‡è¨Š**ï¼šå¦‚æœåŠ å…¥ç¾æœ‰å¢é›†ï¼Œæ‚¨éœ€è¦çŸ¥é“å¢é›†ç¯„åœåç¨±å’Œå¯†ç¢¼

        ## ç¯„ä¾‹ï¼šæ–°å¢åˆ°ç¾æœ‰ HA å¢é›†

        ```
        å¢é›†ç¯„åœï¼špg-ha
        ç¯€é»åç¨±ï¼špatroni4
        etcd ä¸»æ©Ÿï¼šetcd1:2379,etcd2:2379,etcd3:2379
        etcd é€£æ¥åŸ ï¼š2379
        [ä½¿ç”¨èˆ‡ç¾æœ‰å¢é›†ç›¸åŒçš„å¯†ç¢¼]
        ```

        ## é‡è¦æ³¨æ„äº‹é …

        âš ï¸ **å”¯ä¸€ç¯€é»åç¨±**ï¼šåŒä¸€ç¯„åœå…§çš„æ¯å€‹ç¯€é»å¿…é ˆæœ‰ä¸åŒçš„åç¨±

        âš ï¸ **å¯†ç¢¼ä¸€è‡´æ€§**ï¼šåŠ å…¥ç¾æœ‰å¢é›†æ™‚ï¼Œå¯†ç¢¼å¿…é ˆå®Œå…¨ç›¸ç¬¦

    zh-CN:
      description: |
        å°†é¢å¤–çš„ Patroni èŠ‚ç‚¹æ·»åŠ åˆ°ç°æœ‰çš„ PostgreSQL HA é›†ç¾¤ã€‚ä½¿ç”¨æ­¤æ¨¡æ¿æ¥æ°´å¹³æ‰©å±•é›†ç¾¤æˆ–æ›¿æ¢æ•…éšœèŠ‚ç‚¹ã€‚
      variables:
        - key: PATRONI_SCOPE
          type: STRING
          name: é›†ç¾¤èŒƒå›´
          description: Patroni é›†ç¾¤åç§°ï¼ˆåŠ å…¥ç°æœ‰é›†ç¾¤æ—¶å¿…é¡»åŒ¹é…ï¼‰
        - key: PATRONI_NODE_NAME
          type: STRING
          name: èŠ‚ç‚¹åç§°
          description: æ­¤ Patroni èŠ‚ç‚¹çš„å”¯ä¸€åç§°ï¼ˆä¾‹å¦‚ patroni4ã€patroni5ï¼‰
        - key: ETCD_HOST
          type: STRING
          name: etcd ä¸»æœº
          description: etcd æœåŠ¡å™¨ä¸»æœºåæˆ– IP åœ°å€ï¼ˆä¸å«ç«¯å£ï¼‰
        - key: ETCD_PORT
          type: STRING
          name: etcd ç«¯å£
          description: etcd å®¢æˆ·ç«¯ç«¯å£ï¼ˆé»˜è®¤ 2379ï¼‰
        - key: POSTGRES_SUPERUSER_PASSWORD
          type: PASSWORD
          name: è¶…çº§ç”¨æˆ·å¯†ç 
          description: PostgreSQL è¶…çº§ç”¨æˆ·ï¼ˆpostgres ç”¨æˆ·ï¼‰çš„å¯†ç 
        - key: POSTGRES_REPLICATION_PASSWORD
          type: PASSWORD
          name: å¤åˆ¶å¯†ç 
          description: PostgreSQL å¤åˆ¶ç”¨æˆ·çš„å¯†ç 
        - key: POSTGRES_ADMIN_PASSWORD
          type: PASSWORD
          name: ç®¡ç†å‘˜å¯†ç 
          description: PostgreSQL ç®¡ç†å‘˜ç”¨æˆ·çš„å¯†ç 
      readme: |
        # Patroni PostgreSQL èŠ‚ç‚¹ï¼ˆé›†ç¾¤æ‰©å±•ï¼‰

        æ­¤æ¨¡æ¿å…è®¸æ‚¨å°†é¢å¤–çš„ Patroni èŠ‚ç‚¹æ·»åŠ åˆ°ç°æœ‰çš„ PostgreSQL HA é›†ç¾¤ã€‚

        ## ä½¿ç”¨åœºæ™¯

        1. **æ‰©å±•ç°æœ‰ HA é›†ç¾¤**ï¼šæ·»åŠ æ›´å¤šå‰¯æœ¬ä»¥è·å¾—æ›´é«˜å¯ç”¨æ€§æˆ–è¯»å–æ‰©å±•
        2. **æ›¿æ¢æ•…éšœèŠ‚ç‚¹**ï¼šéƒ¨ç½²æ–°èŠ‚ç‚¹ä»¥æ›¿æ¢æ•…éšœçš„é›†ç¾¤æˆå‘˜

        ## å…ˆå†³æ¡ä»¶

        - **ç°æœ‰çš„ etcd æœåŠ¡**ï¼šæ‚¨å¿…é¡»æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œä¸”å¯è®¿é—®çš„ etcd å®ä¾‹
        - **é›†ç¾¤ä¿¡æ¯**ï¼šå¦‚æœåŠ å…¥ç°æœ‰é›†ç¾¤ï¼Œæ‚¨éœ€è¦çŸ¥é“é›†ç¾¤èŒƒå›´åç§°å’Œå¯†ç 

        ## ç¤ºä¾‹ï¼šæ·»åŠ åˆ°ç°æœ‰ HA é›†ç¾¤

        ```
        é›†ç¾¤èŒƒå›´ï¼špg-ha
        èŠ‚ç‚¹åç§°ï¼špatroni4
        etcd ä¸»æœºï¼šetcd1:2379,etcd2:2379,etcd3:2379
        etcd ç«¯å£ï¼š2379
        [ä½¿ç”¨ä¸ç°æœ‰é›†ç¾¤ç›¸åŒçš„å¯†ç ]
        ```

        ## é‡è¦æ³¨æ„äº‹é¡¹

        âš ï¸ **å”¯ä¸€èŠ‚ç‚¹åç§°**ï¼šåŒä¸€èŒƒå›´å†…çš„æ¯ä¸ªèŠ‚ç‚¹å¿…é¡»æœ‰ä¸åŒçš„åç§°

        âš ï¸ **å¯†ç ä¸€è‡´æ€§**ï¼šåŠ å…¥ç°æœ‰é›†ç¾¤æ—¶ï¼Œå¯†ç å¿…é¡»å®Œå…¨åŒ¹é…

    ja-JP:
      description: |
        æ—¢å­˜ã® PostgreSQL HA ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«è¿½åŠ ã® Patroni ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’æ°´å¹³æ–¹å‘ã«ã‚¹ã‚±ãƒ¼ãƒ«ã—ãŸã‚Šã€éšœå®³ãƒãƒ¼ãƒ‰ã‚’ç½®ãæ›ãˆãŸã‚Šã§ãã¾ã™ã€‚
      variables:
        - key: PATRONI_SCOPE
          type: STRING
          name: ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ—
          description: Patroni ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼åï¼ˆæ—¢å­˜ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«å‚åŠ ã™ã‚‹å ´åˆã¯ä¸€è‡´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼‰
        - key: PATRONI_NODE_NAME
          type: STRING
          name: ãƒãƒ¼ãƒ‰å
          description: ã“ã® Patroni ãƒãƒ¼ãƒ‰ã®ä¸€æ„ã®åå‰ï¼ˆä¾‹ï¼špatroni4ã€patroni5ï¼‰
        - key: ETCD_HOST
          type: STRING
          name: etcd ãƒ›ã‚¹ãƒˆ
          description: etcd ã‚µãƒ¼ãƒãƒ¼ã®ãƒ›ã‚¹ãƒˆåã¾ãŸã¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆãƒãƒ¼ãƒˆãªã—ï¼‰
        - key: ETCD_PORT
          type: STRING
          name: etcd ãƒãƒ¼ãƒˆ
          description: etcd ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒãƒ¼ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ 2379ï¼‰
        - key: POSTGRES_SUPERUSER_PASSWORD
          type: PASSWORD
          name: ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
          description: PostgreSQL ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆpostgres ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
        - key: POSTGRES_REPLICATION_PASSWORD
          type: PASSWORD
          name: ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
          description: PostgreSQL ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
        - key: POSTGRES_ADMIN_PASSWORD
          type: PASSWORD
          name: ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
          description: PostgreSQL ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
      readme: |
        # Patroni PostgreSQL ãƒãƒ¼ãƒ‰ï¼ˆã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ‹¡å¼µï¼‰

        ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€æ—¢å­˜ã® PostgreSQL HA ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«è¿½åŠ ã® Patroni ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã§ãã¾ã™ã€‚

        ## ä½¿ç”¨ã‚±ãƒ¼ã‚¹

        1. **æ—¢å­˜ HA ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®æ‹¡å¼µ**ï¼šã‚ˆã‚Šé«˜ã„å¯ç”¨æ€§ã‚„ãƒªãƒ¼ãƒ‰ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®ãŸã‚ã«ãƒ¬ãƒ—ãƒªã‚«ã‚’è¿½åŠ 
        2. **éšœå®³ãƒãƒ¼ãƒ‰ã®ç½®ãæ›ãˆ**ï¼šéšœå®³ã®ã‚ã‚‹ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ¡ãƒ³ãƒãƒ¼ã‚’ç½®ãæ›ãˆã‚‹ãŸã‚ã®æ–°ã—ã„ãƒãƒ¼ãƒ‰ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

        ## å‰ææ¡ä»¶

        - **æ—¢å­˜ã® etcd ã‚µãƒ¼ãƒ“ã‚¹**ï¼šå®Ÿè¡Œä¸­ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãª etcd ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒå¿…è¦
        - **ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æƒ…å ±**ï¼šæ—¢å­˜ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«å‚åŠ ã™ã‚‹å ´åˆã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ—åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦

        ## ä¾‹ï¼šæ—¢å­˜ HA ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¸ã®è¿½åŠ 

        ```
        ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ—ï¼špg-ha
        ãƒãƒ¼ãƒ‰åï¼špatroni4
        etcd ãƒ›ã‚¹ãƒˆï¼šetcd1:2379,etcd2:2379,etcd3:2379
        etcd ãƒãƒ¼ãƒˆï¼š2379
        [æ—¢å­˜ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¨åŒã˜ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ç”¨]
        ```

        ## é‡è¦äº‹é …

        âš ï¸ **ä¸€æ„ã®ãƒãƒ¼ãƒ‰å**ï¼šåŒã˜ã‚¹ã‚³ãƒ¼ãƒ—å†…ã®å„ãƒãƒ¼ãƒ‰ã¯ç•°ãªã‚‹åå‰ã‚’æŒã¤å¿…è¦ãŒã‚ã‚Šã¾ã™

        âš ï¸ **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ä¸€è²«æ€§**ï¼šæ—¢å­˜ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«å‚åŠ ã™ã‚‹å ´åˆã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å®Œå…¨ã«ä¸€è‡´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

    es-ES:
      description: |
        Agregue nodos Patroni adicionales a un clÃºster PostgreSQL HA existente. Use esto para escalar su clÃºster horizontalmente o reemplazar nodos fallidos.
      variables:
        - key: PATRONI_SCOPE
          type: STRING
          name: Alcance del clÃºster
          description: Nombre del clÃºster Patroni (debe coincidir con el clÃºster existente si se une)
        - key: PATRONI_NODE_NAME
          type: STRING
          name: Nombre del nodo
          description: Nombre Ãºnico para este nodo Patroni (ej. patroni4, patroni5)
        - key: ETCD_HOST
          type: STRING
          name: Host de etcd
          description: Nombre de host o direcciÃ³n IP del servidor etcd (sin puerto)
        - key: ETCD_PORT
          type: STRING
          name: Puerto de etcd
          description: Puerto del cliente etcd (predeterminado 2379)
        - key: POSTGRES_SUPERUSER_PASSWORD
          type: PASSWORD
          name: ContraseÃ±a de superusuario
          description: ContraseÃ±a para el superusuario de PostgreSQL (usuario postgres)
        - key: POSTGRES_REPLICATION_PASSWORD
          type: PASSWORD
          name: ContraseÃ±a de replicaciÃ³n
          description: ContraseÃ±a para el usuario de replicaciÃ³n de PostgreSQL
        - key: POSTGRES_ADMIN_PASSWORD
          type: PASSWORD
          name: ContraseÃ±a de administrador
          description: ContraseÃ±a para el usuario administrador de PostgreSQL
      readme: |
        # Nodo Patroni PostgreSQL (ExpansiÃ³n de clÃºster)

        Esta plantilla le permite agregar nodos Patroni adicionales a un clÃºster PostgreSQL HA existente.

        ## Casos de uso

        1. **Expandir clÃºster HA existente**: Agregar mÃ¡s rÃ©plicas para mayor disponibilidad o escalado de lectura
        2. **Reemplazar nodo fallido**: Desplegar un nuevo nodo para reemplazar un miembro fallido

        ## Requisitos previos

        - **Servicio etcd existente**: Debe tener una instancia etcd ejecutÃ¡ndose y accesible
        - **InformaciÃ³n del clÃºster**: Si se une a un clÃºster existente, necesita el nombre del alcance y las contraseÃ±as

        ## Ejemplo: Agregar a clÃºster HA existente

        ```
        Alcance del clÃºster: pg-ha
        Nombre del nodo: patroni4
        Host de etcd: etcd1:2379,etcd2:2379,etcd3:2379
        Puerto de etcd: 2379
        [Usar las mismas contraseÃ±as que el clÃºster existente]
        ```

        ## Notas importantes

        âš ï¸ **Nombres de nodo Ãºnicos**: Cada nodo en el mismo alcance debe tener un nombre diferente

        âš ï¸ **Consistencia de contraseÃ±as**: Las contraseÃ±as deben coincidir exactamente al unirse a un clÃºster existente

    id-ID:
      description: |
        Tambahkan node Patroni tambahan ke kluster PostgreSQL HA yang ada. Gunakan ini untuk memperluas kluster Anda secara horizontal atau mengganti node yang gagal.
      variables:
        - key: PATRONI_SCOPE
          type: STRING
          name: Lingkup Kluster
          description: Nama kluster Patroni (harus cocok dengan kluster yang ada jika bergabung)
        - key: PATRONI_NODE_NAME
          type: STRING
          name: Nama Node
          description: Nama unik untuk node Patroni ini (contoh patroni4, patroni5)
        - key: ETCD_HOST
          type: STRING
          name: Host etcd
          description: Hostname atau alamat IP server etcd (tanpa port)
        - key: ETCD_PORT
          type: STRING
          name: Port etcd
          description: Port klien etcd (default 2379)
        - key: POSTGRES_SUPERUSER_PASSWORD
          type: PASSWORD
          name: Kata Sandi Superuser
          description: Kata sandi untuk superuser PostgreSQL (pengguna postgres)
        - key: POSTGRES_REPLICATION_PASSWORD
          type: PASSWORD
          name: Kata Sandi Replikasi
          description: Kata sandi untuk pengguna replikasi PostgreSQL
        - key: POSTGRES_ADMIN_PASSWORD
          type: PASSWORD
          name: Kata Sandi Admin
          description: Kata sandi untuk pengguna admin PostgreSQL
      readme: |
        # Node Patroni PostgreSQL (Ekspansi Kluster)

        Template ini memungkinkan Anda menambahkan node Patroni tambahan ke kluster PostgreSQL HA yang ada.

        ## Kasus Penggunaan

        1. **Perluas kluster HA yang ada**: Tambah lebih banyak replika untuk ketersediaan lebih tinggi atau penskalaan baca
        2. **Ganti node yang gagal**: Deploy node baru untuk mengganti anggota kluster yang gagal

        ## Prasyarat

        - **Layanan etcd yang ada**: Anda harus memiliki instans etcd yang berjalan dan dapat diakses
        - **Informasi kluster**: Jika bergabung dengan kluster yang ada, Anda perlu nama lingkup dan kata sandi

        ## Contoh: Menambah ke kluster HA yang ada

        ```
        Lingkup Kluster: pg-ha
        Nama Node: patroni4
        Host etcd: etcd1:2379,etcd2:2379,etcd3:2379
        Port etcd: 2379
        [Gunakan kata sandi yang sama dengan kluster yang ada]
        ```

        ## Catatan Penting

        âš ï¸ **Nama node unik**: Setiap node dalam lingkup yang sama harus memiliki nama berbeda

        âš ï¸ **Konsistensi kata sandi**: Kata sandi harus sama persis saat bergabung dengan kluster yang ada
