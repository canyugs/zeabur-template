# yaml-language-server: $schema=https://schema.zeabur.app/template.json
apiVersion: zeabur.com/v1
kind: Template
metadata:
    name: moltbot with Browser
spec:
    description: |
      moltbot with Browser is a personal AI assistant with built-in browser automation capabilities. It can browse the web, interact with websites, and perform automated tasks via Chrome DevTools Protocol.
    icon: https://raw.githubusercontent.com/moltbot/moltbot/main/docs/assets/pixel-lobster.svg
    coverImage: https://raw.githubusercontent.com/moltbot/moltbot/main/docs/whatsapp-clawd.jpg
    variables:
      - key: PUBLIC_DOMAIN
        type: DOMAIN
        name: Domain
        description: What domain do you want to bind moltbot to?
      - key: ZEABUR_AI_HUB_API_KEY
        type: STRING
        name: Zeabur AI Hub API Key (Recommended)
        description: Your Zeabur AI Hub API key for using Gemini/GPT/Claude/DeepSeek via AI Hub
      - key: ANTHROPIC_API_KEY
        type: STRING
        name: Anthropic API Key
        description: Your Anthropic API key for Claude (optional, can be configured later)
      - key: OPENAI_API_KEY
        type: STRING
        name: OpenAI API Key
        description: Your OpenAI API key (optional, can be configured later)
    tags:
      - AI
      - Assistant
      - Chatbot
      - Browser
      - Automation
      - WhatsApp
      - Telegram
    resourceUsage:
      cpu: 3
      memory: 3072

    readme: |
      # moltbot with Browser
      moltbot with Browser is a personal AI assistant with built-in browser automation capabilities. The AI can browse websites, fill forms, click buttons, and extract information from web pages.

      ## Architecture
      This template deploys two services:
      - **moltbot**: The main AI assistant service
      - **moltbot-browser**: A headless Chromium browser sandbox that moltbot controls via CDP (Chrome DevTools Protocol)

      ## Features
      - Browse any website and interact with page elements
      - Fill forms and submit data
      - Extract text, images, and structured data from web pages
      - Take screenshots of web pages
      - Execute JavaScript in the browser context
      - All standard moltbot features (messaging platforms, AI chat, etc.)

      ## Recommended Resources
      Browser automation requires more resources than the basic moltbot.
      - **Shared Cluster**: 3000 m (3 vCPU), 3072 Mi (3 GB)
      - **Dedicated Server**: Recommended for heavy browser usage

      ## Usage
      1. After deployment, a secure Gateway token is **automatically generated** for you
      2. Find the pre-generated URL in the **Instructions** tab
      3. Click the "Web UI (with token)" link to connect directly
      4. The browser sandbox starts automatically when moltbot needs it

      ## Browser Tool
      The AI assistant can use the browser tool to:
      - Navigate to URLs: `browser navigate https://example.com`
      - Click elements: `browser click "Submit button"`
      - Fill inputs: `browser fill "Email field" "user@example.com"`
      - Take screenshots: `browser screenshot`
      - Extract page content: `browser snapshot`

      ## Configuration
      - `ZEABUR_AI_HUB_API_KEY`: Your Zeabur AI Hub API key (Recommended)
      - `ANTHROPIC_API_KEY`: Your Anthropic API key for Claude
      - `OPENAI_API_KEY`: Your OpenAI API key (optional)

      ## Data Persistence
      - `/home/node/.clawdbot` - Configuration, sessions, and credentials
      - `/home/node/clawd` - Workspace and memory files
      - Browser data is ephemeral (cleared on restart)

      ## Documentation
      - GitHub: https://github.com/moltbot/moltbot

    services:
      # Main moltbot service
      - name: moltbot
        icon: https://raw.githubusercontent.com/moltbot/moltbot/main/docs/assets/pixel-lobster.svg
        template: PREBUILT
        domainKey: PUBLIC_DOMAIN
        spec:
          source:
            image: ghcr.io/moltbot/clawdbot:main
            command:
              - /bin/sh
              - -c
              - |
                # Setup moltbot command (clawdbot also works for backward compatibility)
                WORKDIR="$(pwd)"
                mkdir -p /home/node/bin
                cat > /home/node/bin/moltbot << SCRIPT
                #!/bin/sh
                exec node ${WORKDIR}/dist/index.js "\$@"
                SCRIPT
                chmod +x /home/node/bin/moltbot
                ln -sf /home/node/bin/moltbot /home/node/bin/clawdbot
                export PATH="/home/node/bin:$PATH"

                # Create initial config (only if not exists)
                CONFIG_FILE="/home/node/.clawdbot/clawdbot.json"
                mkdir -p /home/node/.clawdbot
                chmod 700 /home/node/.clawdbot

                if [ ! -f "$CONFIG_FILE" ]; then
                  echo "Creating initial config with browser support..."

                  # Build config JSON with browser settings
                  CONFIG_JSON='{"gateway":{"trustedProxies":["0.0.0.0/0"],"controlUi":{"allowInsecureAuth":true}},"browser":{"enabled":true,"attachOnly":true,"defaultProfile":"clawd","profiles":{"clawd":{"cdpUrl":"http://moltbot-sandbox-browser:9222","color":"#FF4500"}}}}'

                  # Add Zeabur AI Hub if configured
                  if [ -n "${ZEABUR_AI_HUB_API_KEY}" ]; then
                    CONFIG_JSON=$(echo "$CONFIG_JSON" | node -e "
                      const fs = require('fs');
                      let config = JSON.parse(fs.readFileSync(0, 'utf8'));
                      config.agents = { defaults: { model: { primary: 'zeabur-ai/gpt-5-mini' } } };
                      config.models = { providers: { 'zeabur-ai': {
                        baseUrl: 'https://hnd1.aihub.zeabur.ai/v1',
                        apiKey: process.env.ZEABUR_AI_HUB_API_KEY,
                        api: 'openai-completions',
                        models: [
                          { id: 'gemini-3-pro-image-preview', name: 'Gemini 3 Pro Image Preview (Zeabur AI Hub)', reasoning: false, input: ['text', 'image'], cost: { input: 2, output: 120, cacheRead: 0, cacheWrite: 0 }, contextWindow: 1000000, maxTokens: 8192 },
                          { id: 'gemini-3-pro-preview', name: 'Gemini 3 Pro Preview (Zeabur AI Hub)', reasoning: false, input: ['text', 'image'], cost: { input: 2, output: 12, cacheRead: 0.2, cacheWrite: 0 }, contextWindow: 1000000, maxTokens: 8192 },
                          { id: 'gpt-5', name: 'GPT-5 (Zeabur AI Hub)', reasoning: false, input: ['text', 'image'], cost: { input: 1.25, output: 10, cacheRead: 0.13, cacheWrite: 0 }, contextWindow: 400000, maxTokens: 8192 },
                          { id: 'claude-sonnet-4-5', name: 'Claude Sonnet 4.5 (Zeabur AI Hub)', reasoning: false, input: ['text', 'image'], cost: { input: 3.3, output: 16.5, cacheRead: 0.33, cacheWrite: 0 }, contextWindow: 1000000, maxTokens: 8192 },
                          { id: 'gemini-3-flash-preview', name: 'Gemini 3 Flash Preview (Zeabur AI Hub)', reasoning: false, input: ['text', 'image'], cost: { input: 0.5, output: 3, cacheRead: 0.05, cacheWrite: 0 }, contextWindow: 1000000, maxTokens: 8192 },
                          { id: 'gpt-5-mini', name: 'GPT-5 Mini (Zeabur AI Hub)', reasoning: false, input: ['text', 'image'], cost: { input: 0.25, output: 2, cacheRead: 0.03, cacheWrite: 0 }, contextWindow: 400000, maxTokens: 8192 },
                          { id: 'claude-haiku-4-5', name: 'Claude Haiku 4.5 (Zeabur AI Hub)', reasoning: false, input: ['text', 'image'], cost: { input: 1.1, output: 5.5, cacheRead: 0.11, cacheWrite: 0 }, contextWindow: 1000000, maxTokens: 8192 },
                          { id: 'gemini-2.5-pro', name: 'Gemini 2.5 Pro (Zeabur AI Hub)', reasoning: false, input: ['text', 'image'], cost: { input: 1.25, output: 10, cacheRead: 0.125, cacheWrite: 0 }, contextWindow: 1000000, maxTokens: 8192 },
                          { id: 'gemini-2.5-flash', name: 'Gemini 2.5 Flash (Zeabur AI Hub)', reasoning: false, input: ['text', 'image'], cost: { input: 0.3, output: 2.5, cacheRead: 0.03, cacheWrite: 0 }, contextWindow: 1000000, maxTokens: 8192 },
                          { id: 'gemini-2.5-flash-lite', name: 'Gemini 2.5 Flash Lite (Zeabur AI Hub)', reasoning: false, input: ['text', 'image'], cost: { input: 0.1, output: 0.4, cacheRead: 0.01, cacheWrite: 0 }, contextWindow: 1000000, maxTokens: 8192 },
                          { id: 'gemini-2.5-flash-image', name: 'Gemini 2.5 Flash Image (Zeabur AI Hub)', reasoning: false, input: ['text', 'image'], cost: { input: 0.3, output: 30, cacheRead: 0, cacheWrite: 0 }, contextWindow: 1000000, maxTokens: 8192 },
                          { id: 'deepseek-v3.2', name: 'DeepSeek V3.2 (Zeabur AI Hub)', reasoning: false, input: ['text'], cost: { input: 0.27, output: 0.4, cacheRead: 0.216, cacheWrite: 0 }, contextWindow: 164000, maxTokens: 8192 },
                          { id: 'gpt-4.1', name: 'GPT-4.1 (Zeabur AI Hub)', reasoning: false, input: ['text', 'image'], cost: { input: 2, output: 8, cacheRead: 0, cacheWrite: 0 }, contextWindow: 1048576, maxTokens: 8192 },
                          { id: 'gpt-4.1-mini', name: 'GPT-4.1 mini (Zeabur AI Hub)', reasoning: false, input: ['text', 'image'], cost: { input: 0.4, output: 1.6, cacheRead: 0.1, cacheWrite: 0 }, contextWindow: 1048576, maxTokens: 8192 },
                          { id: 'gpt-4o', name: 'GPT-4o (Zeabur AI Hub)', reasoning: false, input: ['text', 'image'], cost: { input: 2.5, output: 10, cacheRead: 1.25, cacheWrite: 0 }, contextWindow: 128000, maxTokens: 8192 },
                          { id: 'gpt-4o-mini', name: 'GPT-4o mini (Zeabur AI Hub)', reasoning: false, input: ['text', 'image'], cost: { input: 0.15, output: 0.6, cacheRead: 0.075, cacheWrite: 0 }, contextWindow: 128000, maxTokens: 8192 },
                          { id: 'gpt-oss-120b', name: 'GPT OSS 120B (Zeabur AI Hub)', reasoning: false, input: ['text'], cost: { input: 0.35, output: 0.75, cacheRead: 0, cacheWrite: 0 }, contextWindow: 131072, maxTokens: 8192 },
                          { id: 'grok-4-fast-non-reasoning', name: 'Grok 4 Fast (Zeabur AI Hub)', reasoning: false, input: ['text', 'image'], cost: { input: 0.2, output: 0.5, cacheRead: 0.05, cacheWrite: 0 }, contextWindow: 2000000, maxTokens: 8192 },
                          { id: 'glm-4.6', name: 'GLM-4.6 (Zeabur AI Hub)', reasoning: false, input: ['text', 'image'], cost: { input: 0.45, output: 1.9, cacheRead: 0.11, cacheWrite: 0 }, contextWindow: 204800, maxTokens: 8192 },
                          { id: 'llama-3.3-70b', name: 'Llama 3.3 70B (Zeabur AI Hub)', reasoning: false, input: ['text'], cost: { input: 0.85, output: 1.2, cacheRead: 0, cacheWrite: 0 }, contextWindow: 65536, maxTokens: 8192 },
                          { id: 'qwen-3-32', name: 'Qwen 3 32B (Zeabur AI Hub)', reasoning: false, input: ['text'], cost: { input: 0.4, output: 0.8, cacheRead: 0, cacheWrite: 0 }, contextWindow: 32768, maxTokens: 8192 },
                          { id: 'qwen3-next', name: 'Qwen 3 Next 80B (Zeabur AI Hub)', reasoning: false, input: ['text'], cost: { input: 0.14, output: 1.1, cacheRead: 0, cacheWrite: 0 }, contextWindow: 32768, maxTokens: 8192 },
                          { id: 'kimi-k2-thinking', name: 'Kimi K2 Thinking (Zeabur AI Hub)', reasoning: false, input: ['text'], cost: { input: 0.55, output: 2.5, cacheRead: 0, cacheWrite: 0 }, contextWindow: 131072, maxTokens: 8192 }
                        ]
                      }}};
                      console.log(JSON.stringify(config));
                    ")
                  fi

                  # Write formatted config
                  echo "$CONFIG_JSON" | node -e "
                    const fs = require('fs');
                    const config = JSON.parse(fs.readFileSync(0, 'utf8'));
                    console.log(JSON.stringify(config, null, 2));
                  " > "$CONFIG_FILE"
                  chmod 600 "$CONFIG_FILE"
                else
                  echo "Config exists, checking for updates..."
                  # Add browser config if not present
                  node -e "
                    const fs = require('fs');
                    const configPath = '$CONFIG_FILE';

                    try {
                      const config = JSON.parse(fs.readFileSync(configPath, 'utf8'));

                      let updated = false;

                      // Add browser config if not present
                      if (!config.browser) {
                        config.browser = {
                          enabled: true,
                          attachOnly: true,
                          defaultProfile: 'clawd',
                          profiles: {
                            clawd: {
                              cdpUrl: 'http://moltbot-sandbox-browser:9222',
                              color: '#FF4500'
                            }
                          }
                        };
                        updated = true;
                        console.log('Added browser configuration.');
                      }

                      // Add Zeabur AI Hub provider if API key is set but provider doesn't exist
                      if (process.env.ZEABUR_AI_HUB_API_KEY && !config.models?.providers?.['zeabur-ai']) {
                        console.log('Adding Zeabur AI Hub provider...');
                        if (!config.models) config.models = {};
                        if (!config.models.providers) config.models.providers = {};
                        config.models.providers['zeabur-ai'] = {
                          baseUrl: 'https://hnd1.aihub.zeabur.ai/v1',
                          apiKey: process.env.ZEABUR_AI_HUB_API_KEY,
                          api: 'openai-completions',
                          models: [
                            { id: 'gemini-3-pro-image-preview', name: 'Gemini 3 Pro Image Preview (Zeabur AI Hub)', reasoning: false, input: ['text', 'image'], cost: { input: 2, output: 120, cacheRead: 0, cacheWrite: 0 }, contextWindow: 1000000, maxTokens: 8192 },
                            { id: 'gpt-5-mini', name: 'GPT-5 Mini (Zeabur AI Hub)', reasoning: false, input: ['text', 'image'], cost: { input: 0.25, output: 2, cacheRead: 0.03, cacheWrite: 0 }, contextWindow: 400000, maxTokens: 8192 }
                          ]
                        };
                        updated = true;
                      }

                      if (updated) {
                        fs.writeFileSync(configPath, JSON.stringify(config, null, 2));
                        console.log('Configuration updated.');
                      }
                    } catch (err) {
                      console.error('Warning: Failed to update config:', err.message);
                    }
                  "
                  chmod 600 "$CONFIG_FILE" 2>/dev/null || true
                fi

                # Initialize workspace with memory files
                WORKSPACE_DIR="/home/node/clawd"
                mkdir -p "$WORKSPACE_DIR/memory"
                if [ ! -f "$WORKSPACE_DIR/MEMORY.md" ]; then
                  echo "# Memory" > "$WORKSPACE_DIR/MEMORY.md"
                  echo "" >> "$WORKSPACE_DIR/MEMORY.md"
                  echo "This file stores long-term memories. The AI will write important information here." >> "$WORKSPACE_DIR/MEMORY.md"
                fi

                exec node dist/index.js gateway --allow-unconfigured --bind "${CLAWDBOT_GATEWAY_BIND}" --port "${CLAWDBOT_GATEWAY_PORT}" --token "${CLAWDBOT_GATEWAY_TOKEN}"
          ports:
          - id: web
            port: 18789
            type: HTTP
          healthCheck:
            type: TCP
            port: web
          volumes:
            - id: config
              dir: /home/node/.clawdbot
            - id: workspace
              dir: /home/node/clawd
          env:
            HOME:
              default: /home/node
              readonly: true
            PATH:
              default: /home/node/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
              readonly: true
            NODE_ENV:
              default: production
              readonly: true
            NODE_OPTIONS:
              default: --max-old-space-size=1024
              readonly: true
            CLAWDBOT_GATEWAY_PORT:
              default: "18789"
              readonly: true
            CLAWDBOT_GATEWAY_BIND:
              default: lan
              readonly: true
            CLAWDBOT_GATEWAY_TOKEN:
              default: ${PASSWORD}
            ANTHROPIC_API_KEY:
              default: ${ANTHROPIC_API_KEY}
            OPENAI_API_KEY:
              default: ${OPENAI_API_KEY}
            ZEABUR_AI_HUB_API_KEY:
              default: ${ZEABUR_AI_HUB_API_KEY}
          instructions:
            - type: TEXT
              title: Web UI (with token)
              content: ${ZEABUR_WEB_URL}?token=${CLAWDBOT_GATEWAY_TOKEN}
            - type: PASSWORD
              title: Gateway Token
              content: ${CLAWDBOT_GATEWAY_TOKEN}
              category: Credentials

      # Browser sandbox service
      - name: moltbot-sandbox-browser
        icon: https://raw.githubusercontent.com/moltbot/moltbot/main/docs/assets/pixel-lobster.svg
        template: PREBUILT
        spec:
          source:
            image: ghcr.io/canyugs/moltbot-sandbox-browser:main
          ports:
          - id: cdp
            port: 9222
            type: TCP
          healthCheck:
            type: TCP
            port: cdp
          env:
            CLAWDBOT_BROWSER_HEADLESS:
              default: "1"
              readonly: true
            CLAWDBOT_BROWSER_ENABLE_NOVNC:
              default: "0"
              readonly: true
            CLAWDBOT_BROWSER_CDP_PORT:
              default: "9222"
              readonly: true

localization:
  zh-TW:
    name: moltbot 瀏覽器版
    description: moltbot 瀏覽器版是一個具備瀏覽器自動化功能的個人 AI 助手。它可以瀏覽網頁、與網站互動，並透過 Chrome DevTools Protocol 執行自動化任務。
    variables:
      - key: PUBLIC_DOMAIN
        name: 網域
        description: 您想要綁定 moltbot 的網域是？
      - key: ZEABUR_AI_HUB_API_KEY
        name: Zeabur AI Hub API 金鑰（推薦）
        description: 您的 Zeabur AI Hub API 金鑰，透過 AI Hub 使用 Gemini/GPT/Claude/DeepSeek
      - key: ANTHROPIC_API_KEY
        name: Anthropic API 金鑰
        description: 您的 Anthropic Claude API 金鑰（選填，可之後再設定）
      - key: OPENAI_API_KEY
        name: OpenAI API 金鑰
        description: 您的 OpenAI API 金鑰（選填，可之後再設定）
    readme: |
      # moltbot 瀏覽器版
      moltbot 瀏覽器版是一個具備瀏覽器自動化功能的個人 AI 助手。AI 可以瀏覽網站、填寫表單、點擊按鈕，並從網頁中擷取資訊。

      ## 架構
      此模板部署兩個服務：
      - **moltbot**：主要的 AI 助手服務
      - **moltbot-browser**：無頭 Chromium 瀏覽器沙盒，moltbot 透過 CDP（Chrome DevTools Protocol）控制

      ## 功能
      - 瀏覽任何網站並與頁面元素互動
      - 填寫表單並提交資料
      - 從網頁中擷取文字、圖片和結構化資料
      - 對網頁進行截圖
      - 在瀏覽器環境中執行 JavaScript
      - 所有標準 moltbot 功能（訊息平台、AI 聊天等）

      ## 建議資源配置
      瀏覽器自動化需要比基本 moltbot 更多的資源。
      - **共享叢集**：3000 m（3 vCPU）、3072 Mi（3 GB）
      - **專用伺服器**：推薦用於大量瀏覽器使用

      ## 使用方式
      1. 部署完成後，系統會**自動產生**一組安全的 Gateway Token
      2. 在**使用說明**頁籤找到預先產生的 URL
      3. 點擊「Web UI (with token)」連結直接連線
      4. 當 moltbot 需要時，瀏覽器沙盒會自動啟動

      ## 瀏覽器工具
      AI 助手可以使用瀏覽器工具來：
      - 導航到 URL：`browser navigate https://example.com`
      - 點擊元素：`browser click "提交按鈕"`
      - 填寫輸入框：`browser fill "電子郵件欄位" "user@example.com"`
      - 截圖：`browser screenshot`
      - 擷取頁面內容：`browser snapshot`

      ## 設定
      - `ZEABUR_AI_HUB_API_KEY`：您的 Zeabur AI Hub API 金鑰（推薦）
      - `ANTHROPIC_API_KEY`：您的 Anthropic Claude API 金鑰
      - `OPENAI_API_KEY`：您的 OpenAI API 金鑰（選填）

      ## 資料持久化
      - `/home/node/.clawdbot` - 設定、會話和憑證
      - `/home/node/clawd` - 工作區和記憶檔案
      - 瀏覽器資料為暫時性（重啟後清除）

      ## 文件
      - GitHub：https://github.com/moltbot/moltbot

  zh-CN:
    name: moltbot 浏览器版
    description: moltbot 浏览器版是一个具备浏览器自动化功能的个人 AI 助手。它可以浏览网页、与网站互动，并通过 Chrome DevTools Protocol 执行自动化任务。
    variables:
      - key: PUBLIC_DOMAIN
        name: 域名
        description: 您想要绑定 moltbot 的域名是？
      - key: ZEABUR_AI_HUB_API_KEY
        name: Zeabur AI Hub API 密钥（推荐）
        description: 您的 Zeabur AI Hub API 密钥，通过 AI Hub 使用 Gemini/GPT/Claude/DeepSeek
      - key: ANTHROPIC_API_KEY
        name: Anthropic API 密钥
        description: 您的 Anthropic Claude API 密钥（选填，可之后再设定）
      - key: OPENAI_API_KEY
        name: OpenAI API 密钥
        description: 您的 OpenAI API 密钥（选填，可之后再设定）
    readme: |
      # moltbot 浏览器版
      moltbot 浏览器版是一个具备浏览器自动化功能的个人 AI 助手。AI 可以浏览网站、填写表单、点击按钮，并从网页中提取信息。

      ## 架构
      此模板部署两个服务：
      - **moltbot**：主要的 AI 助手服务
      - **moltbot-browser**：无头 Chromium 浏览器沙盒，moltbot 通过 CDP（Chrome DevTools Protocol）控制

      ## 功能
      - 浏览任何网站并与页面元素互动
      - 填写表单并提交数据
      - 从网页中提取文字、图片和结构化数据
      - 对网页进行截图
      - 在浏览器环境中执行 JavaScript
      - 所有标准 moltbot 功能（消息平台、AI 聊天等）

      ## 建议资源配置
      浏览器自动化需要比基本 moltbot 更多的资源。
      - **共享集群**：3000 m（3 vCPU）、3072 Mi（3 GB）
      - **专用服务器**：推荐用于大量浏览器使用

      ## 使用方式
      1. 部署完成后，系统会**自动生成**一组安全的 Gateway Token
      2. 在**使用说明**页签找到预先生成的 URL
      3. 点击「Web UI (with token)」链接直接连接
      4. 当 moltbot 需要时，浏览器沙盒会自动启动

      ## 浏览器工具
      AI 助手可以使用浏览器工具来：
      - 导航到 URL：`browser navigate https://example.com`
      - 点击元素：`browser click "提交按钮"`
      - 填写输入框：`browser fill "电子邮件字段" "user@example.com"`
      - 截图：`browser screenshot`
      - 提取页面内容：`browser snapshot`

      ## 配置
      - `ZEABUR_AI_HUB_API_KEY`：您的 Zeabur AI Hub API 密钥（推荐）
      - `ANTHROPIC_API_KEY`：您的 Anthropic Claude API 密钥
      - `OPENAI_API_KEY`：您的 OpenAI API 密钥（选填）

      ## 数据持久化
      - `/home/node/.clawdbot` - 配置、会话和凭证
      - `/home/node/clawd` - 工作区和记忆文件
      - 浏览器数据为临时性（重启后清除）

      ## 文档
      - GitHub：https://github.com/moltbot/moltbot
