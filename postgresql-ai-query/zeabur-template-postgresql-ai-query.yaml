# yaml-language-server: $schema=https://schema.zeabur.app/template.json
apiVersion: zeabur.com/v1
kind: Template
metadata:
    name: postgresql-ai-query (dev version)
spec:
    description: PostgreSQL with pg_ai_query extension for natural language SQL generation powered by OpenAI and Anthropic AI models
    coverImage: https://raw.githubusercontent.com/zeabur/service-icons/main/marketplace/postgresql.svg
    icon: https://raw.githubusercontent.com/zeabur/service-icons/main/marketplace/postgresql.svg
    variables:
        - key: OPENAI_API_KEY
          type: STRING
          name: OpenAI API Key (Optional)
          description: Your OpenAI API key from https://platform.openai.com/api-keys
        - key: ANTHROPIC_API_KEY
          type: STRING
          name: Anthropic API Key (Optional)
          description: Your Anthropic API key from https://console.anthropic.com/settings/keys
    readme: |-
        # PostgreSQL with AI Query Extension

        A powerful PostgreSQL database with built-in AI capabilities for generating SQL queries from natural language.

        ## Features

        - **Natural Language to SQL**: Convert plain English to SQL queries
        - **Multiple AI Providers**: Support for OpenAI (GPT-4o, GPT-4) and Anthropic (Claude)
        - **Automatic Schema Discovery**: AI understands your database structure
        - **Query Performance Analysis**: Get AI-powered optimization suggestions
        - **Built on PostgreSQL 17**: Latest stable PostgreSQL version

        ## Quick Start

        ### 1. Configure AI Provider

        After deployment, set at least one API key:
        - **OpenAI**: Get your key from https://platform.openai.com/api-keys
        - **Anthropic**: Get your key from https://console.anthropic.com/settings/keys

        ### 2. Connect to Database

        Use the connection string from the service instructions.

        ### 3. Start Using AI Queries

        ```sql
        -- Generate queries from natural language
        SELECT generate_query('show all customers who registered in the last 30 days');

        -- Explore your database structure
        SELECT get_database_tables();
        SELECT get_table_details('users');

        -- Analyze query performance
        SELECT explain_query('SELECT * FROM users WHERE created_at > NOW() - INTERVAL ''7 days''');
        ```

        ## Example Use Cases

        ```sql
        -- Business analytics
        SELECT generate_query('monthly sales trend for the last year by category');

        -- Customer insights
        SELECT generate_query('top 10 customers by total purchase amount');

        -- Data quality
        SELECT generate_query('find duplicate email addresses in the users table');

        -- Complex joins
        SELECT generate_query('users who have placed orders but never left a review');
        ```

        ## Configuration

        The extension is pre-configured with sensible defaults:
        - Row limit enforcement (1000 rows max)
        - Query explanations enabled
        - Performance warnings enabled
        - 30-second timeout for AI requests

        You can customize these settings by updating the configuration after deployment.

        ## Documentation

        - Official Docs: https://benodiwal.github.io/pg_ai_query/
        - GitHub: https://github.com/benodiwal/pg_ai_query

        ## Notes

        - The extension requires an active internet connection to call AI APIs
        - Each query generation consumes API credits
        - Keep your API keys secure and monitor usage
    services:
        - name: postgresql-ai-query
          icon: https://raw.githubusercontent.com/zeabur/service-icons/main/marketplace/postgresql.svg
          template: PREBUILT_V2
          spec:
            source:
                image: ghcr.io/canyugs/postgresql-ai-query:17-alpine
            ports:
                - id: database
                  port: 5432
                  type: TCP
            volumes:
                - id: data
                  dir: /var/lib/postgresql/data
                - id: config
                  dir: /var/lib/postgresql/config
            env:
                # Database Configuration
                POSTGRES_DB:
                    default: mydb
                    expose: true
                POSTGRES_USER:
                    default: postgres
                    expose: true
                POSTGRES_PASSWORD:
                    default: ${PASSWORD}
                    expose: true
                POSTGRES_CONNECTION_STRING:
                    default: postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${PORT_FORWARDED_HOSTNAME}:${DATABASE_PORT_FORWARDED_PORT}/${POSTGRES_DB}
                    expose: true

                # AI Provider Configuration
                OPENAI_API_KEY:
                    default: ""
                    expose: true
                ANTHROPIC_API_KEY:
                    default: ""
                    expose: true

                # AI Model Configuration
                AI_DEFAULT_MODEL:
                    default: gpt-4o
                    expose: true
                ANTHROPIC_DEFAULT_MODEL:
                    default: claude-3-5-sonnet-20241022
                    expose: true
            configs:
                - path: /var/lib/postgresql/config/pg_ai.config
                  template: |
                    [general]
                    log_level = "INFO"
                    enable_logging = true
                    request_timeout_ms = 30000
                    max_retries = 3

                    [query]
                    enforce_limit = true
                    default_limit = 1000

                    [response]
                    show_explanation = true
                    show_warnings = true
                    show_suggested_visualization = false
                    use_formatted_response = false

                    [openai]
                    api_key = "${OPENAI_API_KEY}"
                    default_model = "${AI_DEFAULT_MODEL}"

                    [anthropic]
                    api_key = "${ANTHROPIC_API_KEY}"
                    default_model = "${ANTHROPIC_DEFAULT_MODEL}"
                  permission: 0644
                  envsubst: true
            instructions:
                - title: Connection String
                  content: postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${PORT_FORWARDED_HOSTNAME}:${DATABASE_PORT_FORWARDED_PORT}/${POSTGRES_DB}
                - title: Connect Command
                  content: psql "postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${PORT_FORWARDED_HOSTNAME}:${DATABASE_PORT_FORWARDED_PORT}/${POSTGRES_DB}"
                - title: Username
                  content: ${POSTGRES_USER}
                - title: Password
                  content: ${POSTGRES_PASSWORD}
                - title: Database
                  content: ${POSTGRES_DB}
                - title: Test AI Query
                  content: SELECT generate_query('show all tables');
                - title: List Tables
                  content: SELECT get_database_tables();
                - title: Table Details
                  content: SELECT get_table_details('your_table_name');
            healthCheck:
                type: TCP
                port: database
localization:
    zh-TW:
        description: å…§å»º pg_ai_query æ“´å±•çš„ PostgreSQL è³‡æ–™åº«,æ”¯æ´ä½¿ç”¨è‡ªç„¶èªè¨€ç”Ÿæˆ SQL æŸ¥è©¢,ç”± OpenAI å’Œ Anthropic AI æ¨¡å‹é©…å‹•
        readme: |
            # PostgreSQL AI æŸ¥è©¢æ“´å±•

            å¼·å¤§çš„ PostgreSQL 17 è³‡æ–™åº«,å…§å»º AI åŠŸèƒ½,å¯å°‡è‡ªç„¶èªè¨€è½‰æ›ç‚º SQL æŸ¥è©¢ã€‚

            ## ğŸš€ ä¸»è¦åŠŸèƒ½

            - **è‡ªç„¶èªè¨€è½‰ SQL**: å°‡ä¸­æ–‡æˆ–è‹±æ–‡æè¿°è½‰æ›ç‚ºæœ‰æ•ˆçš„ PostgreSQL æŸ¥è©¢
            - **å¤š AI æä¾›å•†**: æ”¯æ´ OpenAI (GPT-4o, GPT-4) å’Œ Anthropic (Claude) æ¨¡å‹
            - **è‡ªå‹•æ¶æ§‹æ¢ç´¢**: AI åˆ†æä½ çš„è³‡æ–™åº«çµæ§‹,ç†è§£è¡¨æ ¼å’Œé—œè¯
            - **æŸ¥è©¢æ•ˆèƒ½åˆ†æ**: åŸ·è¡Œ EXPLAIN ANALYZE ä¸¦ç²å¾— AI é©…å‹•çš„å„ªåŒ–å»ºè­°
            - **å®‰å…¨å„ªå…ˆ**: å…§å»ºè³‡æ–™åˆ—é™åˆ¶å’ŒæŸ¥è©¢é©—è­‰ä¿è­·

            ## ğŸ“– å¿«é€Ÿé–‹å§‹

            1. **è¨­å®š API é‡‘é‘°**: é…ç½® OPENAI_API_KEY æˆ– ANTHROPIC_API_KEY
            2. **é€£ç·š**: ä½¿ç”¨æä¾›çš„é€£ç·šå­—ä¸²
            3. **æŸ¥è©¢**: `SELECT generate_query('ä½ çš„è‡ªç„¶èªè¨€æŸ¥è©¢');`

            ## ğŸ’¡ ç¯„ä¾‹æŸ¥è©¢

            ```sql
            -- å•†æ¥­åˆ†æ
            SELECT generate_query('éå»ä¸€å¹´çš„æœˆåº¦éŠ·å”®è¶¨å‹¢');

            -- è³‡æ–™æ¢ç´¢
            SELECT get_database_tables();
            SELECT get_table_details('orders');

            -- æ•ˆèƒ½åˆ†æ
            SELECT explain_query('SELECT * FROM users WHERE active = true');
            ```

            éå¸¸é©åˆè³‡æ–™åˆ†æå¸«ã€é–‹ç™¼è€…,ä»¥åŠä»»ä½•æƒ³ç”¨è‡ªç„¶èªè¨€æŸ¥è©¢è³‡æ–™åº«çš„äºº!

            â†’ æ–‡ä»¶: https://benodiwal.github.io/pg_ai_query/
            â†’ åŸå§‹ç¢¼: https://github.com/benodiwal/pg_ai_query
    zh-CN:
        description: å†…ç½® pg_ai_query æ‰©å±•çš„ PostgreSQL æ•°æ®åº“,æ”¯æŒä½¿ç”¨è‡ªç„¶è¯­è¨€ç”Ÿæˆ SQL æŸ¥è¯¢,ç”± OpenAI å’Œ Anthropic AI æ¨¡å‹é©±åŠ¨
        readme: |
            # PostgreSQL AI æŸ¥è¯¢æ‰©å±•

            å¼ºå¤§çš„ PostgreSQL 17 æ•°æ®åº“,å†…ç½® AI åŠŸèƒ½,å¯å°†è‡ªç„¶è¯­è¨€è½¬æ¢ä¸º SQL æŸ¥è¯¢ã€‚

            ## ğŸš€ ä¸»è¦åŠŸèƒ½

            - **è‡ªç„¶è¯­è¨€è½¬ SQL**: å°†ä¸­æ–‡æˆ–è‹±æ–‡æè¿°è½¬æ¢ä¸ºæœ‰æ•ˆçš„ PostgreSQL æŸ¥è¯¢
            - **å¤š AI æä¾›å•†**: æ”¯æŒ OpenAI (GPT-4o, GPT-4) å’Œ Anthropic (Claude) æ¨¡å‹
            - **è‡ªåŠ¨æ¨¡å¼å‘ç°**: AI åˆ†æä½ çš„æ•°æ®åº“ç»“æ„,ç†è§£è¡¨å’Œå…³ç³»
            - **æŸ¥è¯¢æ€§èƒ½åˆ†æ**: è¿è¡Œ EXPLAIN ANALYZE å¹¶è·å¾— AI é©±åŠ¨çš„ä¼˜åŒ–å»ºè®®
            - **å®‰å…¨ä¼˜å…ˆ**: å†…ç½®è¡Œé™åˆ¶å’ŒæŸ¥è¯¢éªŒè¯ä¿æŠ¤

            ## ğŸ“– å¿«é€Ÿå¼€å§‹

            1. **è®¾ç½® API å¯†é’¥**: é…ç½® OPENAI_API_KEY æˆ– ANTHROPIC_API_KEY
            2. **è¿æ¥**: ä½¿ç”¨æä¾›çš„è¿æ¥å­—ç¬¦ä¸²
            3. **æŸ¥è¯¢**: `SELECT generate_query('ä½ çš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢');`

            ## ğŸ’¡ ç¤ºä¾‹æŸ¥è¯¢

            ```sql
            -- ä¸šåŠ¡åˆ†æ
            SELECT generate_query('è¿‡å»ä¸€å¹´çš„æœˆåº¦é”€å”®è¶‹åŠ¿');

            -- æ•°æ®æ¢ç´¢
            SELECT get_database_tables();
            SELECT get_table_details('orders');

            -- æ€§èƒ½åˆ†æ
            SELECT explain_query('SELECT * FROM users WHERE active = true');
            ```

            éå¸¸é€‚åˆæ•°æ®åˆ†æå¸ˆã€å¼€å‘è€…,ä»¥åŠä»»ä½•æƒ³ç”¨è‡ªç„¶è¯­è¨€æŸ¥è¯¢æ•°æ®åº“çš„äºº!

            â†’ æ–‡æ¡£: https://benodiwal.github.io/pg_ai_query/
            â†’ æºç : https://github.com/benodiwal/pg_ai_query
    ja-JP:
        description: OpenAI ã¨ Anthropic AI ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã—ãŸè‡ªç„¶è¨€èªã«ã‚ˆã‚‹ SQL ã‚¯ã‚¨ãƒªç”Ÿæˆæ©Ÿèƒ½ã‚’æŒã¤ pg_ai_query æ‹¡å¼µæ©Ÿèƒ½å†…è”µã® PostgreSQL
        readme: |
            # PostgreSQL AI ã‚¯ã‚¨ãƒªæ‹¡å¼µæ©Ÿèƒ½

            è‡ªç„¶è¨€èªã‚’ SQL ã‚¯ã‚¨ãƒªã«å¤‰æ›ã™ã‚‹ AI æ©Ÿèƒ½ã‚’å†…è”µã—ãŸå¼·åŠ›ãª PostgreSQL 17 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€‚

            ## ğŸš€ ä¸»ãªæ©Ÿèƒ½

            - **è‡ªç„¶è¨€èªã‹ã‚‰ SQL ã¸**: æ—¥æœ¬èªã‚„è‹±èªã®èª¬æ˜ã‚’æœ‰åŠ¹ãª PostgreSQL ã‚¯ã‚¨ãƒªã«å¤‰æ›
            - **è¤‡æ•°ã® AI ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼**: OpenAI (GPT-4o, GPT-4) ã¨ Anthropic (Claude) ãƒ¢ãƒ‡ãƒ«ã‚’ã‚µãƒãƒ¼ãƒˆ
            - **è‡ªå‹•ã‚¹ã‚­ãƒ¼ãƒæ¤œå‡º**: AI ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ã‚’åˆ†æã—ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç†è§£
            - **ã‚¯ã‚¨ãƒªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ**: EXPLAIN ANALYZE ã‚’å®Ÿè¡Œã—ã€AI ã«ã‚ˆã‚‹æœ€é©åŒ–ææ¡ˆã‚’å–å¾—
            - **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å„ªå…ˆ**: è¡Œåˆ¶é™ã¨ã‚¯ã‚¨ãƒªæ¤œè¨¼ã«ã‚ˆã‚‹ä¿è­·æ©Ÿèƒ½ã‚’å†…è”µ

            ## ğŸ“– ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

            1. **API ã‚­ãƒ¼ã‚’è¨­å®š**: OPENAI_API_KEY ã¾ãŸã¯ ANTHROPIC_API_KEY ã‚’è¨­å®š
            2. **æ¥ç¶š**: æä¾›ã•ã‚ŒãŸæ¥ç¶šæ–‡å­—åˆ—ã‚’ä½¿ç”¨
            3. **ã‚¯ã‚¨ãƒª**: `SELECT generate_query('è‡ªç„¶è¨€èªã®ã‚¯ã‚¨ãƒª');`

            ## ğŸ’¡ ã‚¯ã‚¨ãƒªä¾‹

            ```sql
            -- ãƒ“ã‚¸ãƒã‚¹åˆ†æ
            SELECT generate_query('éå»1å¹´é–“ã®æœˆæ¬¡å£²ä¸Šãƒˆãƒ¬ãƒ³ãƒ‰');

            -- ãƒ‡ãƒ¼ã‚¿æ¢ç´¢
            SELECT get_database_tables();
            SELECT get_table_details('orders');

            -- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ
            SELECT explain_query('SELECT * FROM users WHERE active = true');
            ```

            ãƒ‡ãƒ¼ã‚¿ã‚¢ãƒŠãƒªã‚¹ãƒˆã€é–‹ç™ºè€…ã€è‡ªç„¶è¨€èªã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ãŸã„æ–¹ã«æœ€é©ã§ã™!

            â†’ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: https://benodiwal.github.io/pg_ai_query/
            â†’ ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰: https://github.com/benodiwal/pg_ai_query
    es-ES:
        description: PostgreSQL con extensiÃ³n pg_ai_query para generaciÃ³n de consultas SQL en lenguaje natural, impulsado por modelos de IA de OpenAI y Anthropic
        readme: |
            # ExtensiÃ³n de Consultas AI para PostgreSQL

            Una potente base de datos PostgreSQL 17 con capacidades de IA integradas para convertir lenguaje natural en consultas SQL.

            ## ğŸš€ CaracterÃ­sticas Principales

            - **Lenguaje Natural a SQL**: Convierte descripciones en espaÃ±ol o inglÃ©s en consultas PostgreSQL vÃ¡lidas
            - **MÃºltiples Proveedores de IA**: Soporte para modelos OpenAI (GPT-4o, GPT-4) y Anthropic (Claude)
            - **Descubrimiento AutomÃ¡tico de Esquema**: La IA analiza la estructura de tu base de datos, entendiendo tablas y relaciones
            - **AnÃ¡lisis de Rendimiento de Consultas**: Ejecuta EXPLAIN ANALYZE y obtÃ©n sugerencias de optimizaciÃ³n impulsadas por IA
            - **Seguridad Primero**: Protecciones integradas con lÃ­mites de filas y validaciÃ³n de consultas

            ## ğŸ“– Inicio RÃ¡pido

            1. **Configurar Clave API**: Configura OPENAI_API_KEY o ANTHROPIC_API_KEY
            2. **Conectar**: Usa la cadena de conexiÃ³n proporcionada
            3. **Consultar**: `SELECT generate_query('tu consulta en lenguaje natural');`

            ## ğŸ’¡ Ejemplos de Consultas

            ```sql
            -- AnÃ¡lisis de Negocios
            SELECT generate_query('tendencia de ventas mensuales del Ãºltimo aÃ±o');

            -- ExploraciÃ³n de Datos
            SELECT get_database_tables();
            SELECT get_table_details('orders');

            -- AnÃ¡lisis de Rendimiento
            SELECT explain_query('SELECT * FROM users WHERE active = true');
            ```

            Â¡Perfecto para analistas de datos, desarrolladores y cualquiera que quiera consultar bases de datos usando lenguaje natural!

            â†’ DocumentaciÃ³n: https://benodiwal.github.io/pg_ai_query/
            â†’ CÃ³digo Fuente: https://github.com/benodiwal/pg_ai_query
    id-ID:
        description: PostgreSQL dengan ekstensi pg_ai_query untuk pembuatan kueri SQL menggunakan bahasa alami, didukung oleh model AI OpenAI dan Anthropic
        readme: |
            # Ekstensi Kueri AI untuk PostgreSQL

            Database PostgreSQL 17 yang powerful dengan kemampuan AI bawaan untuk mengubah bahasa alami menjadi kueri SQL.

            ## ğŸš€ Fitur Utama

            - **Bahasa Alami ke SQL**: Ubah deskripsi dalam bahasa Indonesia atau Inggris menjadi kueri PostgreSQL yang valid
            - **Multi Penyedia AI**: Dukungan untuk model OpenAI (GPT-4o, GPT-4) dan Anthropic (Claude)
            - **Penemuan Skema Otomatis**: AI menganalisis struktur database Anda, memahami tabel dan relasi
            - **Analisis Performa Kueri**: Jalankan EXPLAIN ANALYZE dan dapatkan saran optimasi berbasis AI
            - **Keamanan Utama**: Perlindungan bawaan dengan batas baris dan validasi kueri

            ## ğŸ“– Mulai Cepat

            1. **Atur Kunci API**: Konfigurasi OPENAI_API_KEY atau ANTHROPIC_API_KEY
            2. **Hubungkan**: Gunakan string koneksi yang disediakan
            3. **Kueri**: `SELECT generate_query('kueri bahasa alami Anda');`

            ## ğŸ’¡ Contoh Kueri

            ```sql
            -- Analisis Bisnis
            SELECT generate_query('tren penjualan bulanan tahun lalu');

            -- Eksplorasi Data
            SELECT get_database_tables();
            SELECT get_table_details('orders');

            -- Analisis Performa
            SELECT explain_query('SELECT * FROM users WHERE active = true');
            ```

            Sempurna untuk analis data, developer, dan siapa saja yang ingin melakukan kueri database menggunakan bahasa alami!

            â†’ Dokumentasi: https://benodiwal.github.io/pg_ai_query/
            â†’ Kode Sumber: https://github.com/benodiwal/pg_ai_query
